
<!DOCTYPE html>

<html class="no-js" lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Daniel Joven" name="author"/>
<link href="https://zentyal-aws.projects.djoven.es/zentyal-configuration/" rel="canonical"/>
<link href="../zentyal-installation/" rel="prev"/>
<link href="../zentyal-certificates/" rel="next"/>
<link href="../assets/favicon.ico" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-9.1.6" name="generator"/>
<title>Configuration - Zentyal &amp; AWS</title>
<link href="../assets/stylesheets/main.ded33207.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.a0c5b2b5.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src="../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="red" data-md-color-primary="" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#configuracion-de-zentyal">
          Saltar a contenido
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Cabecera" class="md-header__inner md-grid">
<a aria-label="Zentyal &amp; AWS" class="md-header__button md-logo" data-md-component="logo" href=".." title="Zentyal &amp; AWS">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Zentyal &amp; AWS
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Configuration
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="red" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="red" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
</form>
<div class="md-header__option">
<div class="md-select">
<button aria-label="Seleccionar idioma" class="md-header__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"></path></svg>
</button>
<div class="md-select__inner">
<ul class="md-select__list">
<li class="md-select__item">
<a class="md-select__link" href="./" hreflang="es">
                    Spanish
                  </a>
</li>
<li class="md-select__item">
<a class="md-select__link" href="../en/zentyal-configuration/" hreflang="en">
                    English
                  </a>
</li>
</ul>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Búsqueda" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Búsqueda" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Buscar" class="md-search__options">
<button aria-label="Limpiar" class="md-search__icon md-icon" tabindex="-1" title="Limpiar" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/djoven89/zentyal-aws" title="Ir al repositorio">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Pestañas" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="..">
      Home
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../aws-configuration/">
      AWS
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../zentyal-installation/">
      Install
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link md-tabs__link--active" href="./">
      Configuration
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../zentyal-certificates/">
      Certificates
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../zentyal-hardening/">
      Hardening
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../backup/">
      Backup
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../monitoring/">
      Monitoring
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../maintenance/">
      Maintenance
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../recovery/">
      Recovery
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../zentyal-bug-fixing/">
      Bug fixing
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../about/">
      About me
    </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navegación" class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Zentyal &amp; AWS" class="md-nav__button md-logo" data-md-component="logo" href=".." title="Zentyal &amp; AWS">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    Zentyal &amp; AWS
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/djoven89/zentyal-aws" title="Ir al repositorio">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
        Home
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../aws-configuration/">
        AWS
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../zentyal-installation/">
        Install
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Configuration
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Configuration
      </a>
<nav aria-label="Tabla de contenidos" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#objetivos">
    Objetivos
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configuracion-opcional">
    Configuración opcional
  </a>
<nav aria-label="Configuración opcional" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#snap">
    Snap
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#prompt">
    Prompt
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#historial">
    Historial
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#vim">
    Vim
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configuracion-previa">
    Configuración previa
  </a>
<nav aria-label="Configuración previa" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#particion-swap">
    Partición SWAP
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#volumenes-ebs-adicionales">
    Volúmenes EBS adicionales
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#quota">
    Quota
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configuracion-de-los-modulos">
    Configuración de los módulos
  </a>
<nav aria-label="Configuración de los módulos" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#general">
    General
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#modulo-de-logs">
    Módulo de Logs
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#modulo-de-cortafuegos">
    Módulo de Cortafuegos
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#modulo-de-software">
    Módulo de Software
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#modulo-de-ntp">
    Módulo de NTP
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#modulo-de-dns">
    Módulo de DNS
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#modulo-de-controlador-de-dominio">
    Módulo de Controlador de dominio
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#modulo-de-correo">
    Módulo de Correo
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#modulo-de-webmail">
    Módulo de Webmail
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#modulo-de-antivirus">
    Módulo de Antivirus
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#modulo-de-mailfilter">
    Módulo de Mailfilter
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#modulo-de-ca">
    Módulo de CA
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#modulo-de-openvpn">
    Módulo de OpenVPN
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../zentyal-certificates/">
        Certificates
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../zentyal-hardening/">
        Hardening
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../backup/">
        Backup
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../monitoring/">
        Monitoring
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../maintenance/">
        Maintenance
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../recovery/">
        Recovery
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../zentyal-bug-fixing/">
        Bug fixing
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../about/">
        About me
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<nav class="md-tags">
<span class="md-tag">Zentyal</span>
</nav>
<h1 id="configuracion-de-zentyal">Configuración de Zentyal<a class="headerlink" href="#configuracion-de-zentyal" title="Permanent link">¶</a></h1>
<p>En esta página se abordará la configuración del servidor Zentyal para que actúe como servidor de correo y compartición de ficheros.</p>
<h2 id="objetivos">Objetivos<a class="headerlink" href="#objetivos" title="Permanent link">¶</a></h2>
<p>Las objetivos que se realizarán serán:</p>
<ol>
<li>(Opcional) Desinstalación de Snap.</li>
<li>(Opcional) Configuración adicional de los usuarios locales del sistema:<ul>
<li>Modificación del Prompt.</li>
<li>Modificaciones sobre el historial.</li>
<li>Configuración para el editor <code>vim</code>.</li>
</ul>
</li>
<li>Creación de una partición SWAP.</li>
<li>Configuración de los volúmenes EBS adicionales.</li>
<li>Implementación de quotas en el sistema de archivo.</li>
<li>Configuración de los siguientes módulos de Zentyal:<ul>
<li>Logs</li>
<li>Firewall</li>
<li>Software</li>
<li>NTP</li>
<li>DNS</li>
<li>Controlador de dominio</li>
<li>Correo</li>
<li>Webmail</li>
<li>Antivirus</li>
<li>Mailfilter</li>
<li>CA</li>
<li>OpenVPN</li>
</ul>
</li>
</ol>
<p>Al término de este documento, el servidor Zentyal quedará listo para usarse, aunque en siguientes documentos seguiremos estableciendo configuraciones adicionales como la configuración de certificados emitidos por Let's Encrypt o configuraciones opciones pero altamente recomendables como por ejemplo, hardening del servicio de correo.</p>
<h2 id="configuracion-opcional">Configuración opcional<a class="headerlink" href="#configuracion-opcional" title="Permanent link">¶</a></h2>
<p>En esta sección se realizarán diversas configuraciones opcionales sobre el servidor Zentyal, por lo que se puede omitir e ir a la sección 'Configuración previa'.</p>
<h3 id="snap">Snap<a class="headerlink" href="#snap" title="Permanent link">¶</a></h3>
<p>Como Zentyal no usa Snap, procederemos a su desinstalación.</p>
<ol>
<li>
<p>Paramos el servicio:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>snapd<span class="w"> </span>snapd.socket
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Eliminamos el paquete:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>remove<span class="w"> </span>--purge<span class="w"> </span>-y<span class="w"> </span>snapd
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Eliminamos los directorios que quedan en el sistema de archivos:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a>sudo<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/root/snap/
</code></pre></div></td></tr></table></div>
</li>
</ol>
<h3 id="prompt">Prompt<a class="headerlink" href="#prompt" title="Permanent link">¶</a></h3>
<p>Para mejorar la experiencia de usuario cuando realizamos tareas desde la CLI, procederemos a habilitar el color del prompt para los usuarios locales existentes y futuros.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">for</span><span class="w"> </span>user<span class="w"> </span><span class="k">in</span><span class="w"> </span>/root<span class="w"> </span>/home/ubuntu<span class="w"> </span>/home/djoven<span class="w"> </span>/etc/skel/<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">    </span>sudo<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">'s/#force_color_prompt/force_color_prompt/'</span><span class="w"> </span><span class="nv">$user</span>/.bashrc
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="k">done</span>
</code></pre></div></td></tr></table></div>
<h3 id="historial">Historial<a class="headerlink" href="#historial" title="Permanent link">¶</a></h3>
<p>Con la finalidad de almacenar más información en el historial personal de los usuarios y que además, haya un timestamp que indique la fecha y hora en la que fue ejecutado determinado comando, añadiremos una serie de opciones adicionales a los usuarios locales tanto existentes como futuros.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="k">for</span><span class="w"> </span>user<span class="w"> </span><span class="k">in</span><span class="w"> </span>/root<span class="w"> </span>/home/ubuntu<span class="w"> </span>/home/djoven<span class="w"> </span>/etc/skel/<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="nv">$user</span>/.bashrc<span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="s">## Custom options</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="s">HISTTIMEFORMAT="%F %T  "</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="s">PROMPT_COMMAND='history -a'</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="s">HISTIGNORE='clear:history'</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="s">EOF</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a>sudo<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span>-e<span class="w"> </span><span class="s1">'s/HISTCONTROL=.*/HISTCONTROL=ignoreboth/'</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="w">            </span>-e<span class="w"> </span><span class="s1">'s/HISTSIZE=.*/HISTSIZE=1000/'</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="w">            </span>-e<span class="w"> </span><span class="s1">'s/HISTFILESIZE=.*/HISTFILESIZE=2000/'</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="w">        </span><span class="nv">$user</span>/.bashrc
<a id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="k">done</span>
</code></pre></div></td></tr></table></div>
<h3 id="vim">Vim<a class="headerlink" href="#vim" title="Permanent link">¶</a></h3>
<p>Añadiremos una configuración personalizada sencilla para el editor de textos <code>vim</code> tanto para los usuarios existentes como futuros. Esta configuración establecerá lo siguiente:</p>
<ul>
<li>Tabulación de 2 espacios.</li>
<li>Habilita el resaltado de sintaxis.</li>
<li>Muestra el número de la líneas.</li>
<li>Usa el esquema de color 'desert'</li>
<li>Configura el editor para usar archivos Yaml.</li>
</ul>
<p>Para establecer la configuración, simplemente habrá que crear un archivo llamado <code>.vimrc</code> en el directorio personal de los usuarios.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="k">for</span><span class="w"> </span>user<span class="w"> </span><span class="k">in</span><span class="w"> </span>/root<span class="w"> </span>/home/ubuntu<span class="w"> </span>/home/djoven<span class="w"> </span>/etc/skel<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="nv">$user</span>/.vimrc<span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="s">set tabstop=2</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="s">syntax on</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="s">set number</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="s">color desert</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="s">set shiftwidth=2</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="s">auto FileType yaml,yml setlocal ai ts=2 sw=2 et</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="s">EOF</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="k">done</span>
</code></pre></div></td></tr></table></div>
<h2 id="configuracion-previa">Configuración previa<a class="headerlink" href="#configuracion-previa" title="Permanent link">¶</a></h2>
<p>A continuación se realizan las configuraciones previas a la configuración de los módulos de Zentyal. Salvo el apartado de <code>Volúmenes EBS adicionales</code>, que sería opcional, el resto deberían de implementarse.</p>
<h3 id="particion-swap">Partición SWAP<a class="headerlink" href="#particion-swap" title="Permanent link">¶</a></h3>
<p>Es altamente recomendable configurar una partición SWAP en el servidor para incrementar la disponibilidad del servidor en caso de picos relacionados con la memoria RAM. Las acciones que realizaremos están documentadas <a href="https://aws.amazon.com/premiumsupport/knowledge-center/ec2-memory-swap-file/">aquí</a>.</p>
<ol>
<li>
<p>Creamos un archivo vacío de 4GB, que será el tamaño de nuestra partición SWAP:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a>sudo<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/zero<span class="w"> </span><span class="nv">of</span><span class="o">=</span>/swapfile1<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>128M<span class="w"> </span><span class="nv">count</span><span class="o">=</span><span class="m">32</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Establecemos los permisos para el archivo:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">0600</span><span class="w"> </span>/swapfile1
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Establecemos el archivo como una área de SWAP:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a>sudo<span class="w"> </span>mkswap<span class="w"> </span>/swapfile1
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Habilitamos la partición SWAP de forma temporal:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a>sudo<span class="w"> </span>swapon<span class="w"> </span>/swapfile1
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Verificamos que el sistema reconoce la nueva partición SWAP ejecutando los siguientes comandos:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a>sudo<span class="w"> </span>swapon<span class="w"> </span>-s
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>sudo<span class="w"> </span>free<span class="w"> </span>-m
</code></pre></div></td></tr></table></div>
<p>El resultado que deberíamos obtener es:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span>
<span class="normal"><a href="#__codelineno-11-2">2</a></span>
<span class="normal"><a href="#__codelineno-11-3">3</a></span>
<span class="normal"><a href="#__codelineno-11-4">4</a></span>
<span class="normal"><a href="#__codelineno-11-5">5</a></span>
<span class="normal"><a href="#__codelineno-11-6">6</a></span>
<span class="normal"><a href="#__codelineno-11-7">7</a></span>
<span class="normal"><a href="#__codelineno-11-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a>## Comando 'swapon'
<a id="__codelineno-11-2" name="__codelineno-11-2"></a>Filename                Type        Size      Used    Priority
<a id="__codelineno-11-3" name="__codelineno-11-3"></a>/swapfile1              file        4194300      0          -2
<a id="__codelineno-11-4" name="__codelineno-11-4"></a>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a>## comando 'free'
<a id="__codelineno-11-6" name="__codelineno-11-6"></a>                total        used        free      shared  buff/cache   available
<a id="__codelineno-11-7" name="__codelineno-11-7"></a>Mem:           3875        1218         209           2        2447        2396
<a id="__codelineno-11-8" name="__codelineno-11-8"></a>Swap:          4095           0        4095
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Establecemos la partición en el archivo de configuración <code>/etc/fstab</code> para que persista ante el reinicio del servidor:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s1">'\n## SWAP partition 4GB\n/swapfile1 swap swap defaults 0 0'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/fstab
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Finalmente, comprobamos que la nueva entrada en el archivo no contenga errores de sintaxis:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a>sudo<span class="w"> </span>mount<span class="w"> </span>-a
</code></pre></div></td></tr></table></div>
</li>
</ol>
<h3 id="volumenes-ebs-adicionales">Volúmenes EBS adicionales<a class="headerlink" href="#volumenes-ebs-adicionales" title="Permanent link">¶</a></h3>
<p>En caso de que hayamos añadido volúmenes EBS adicionales - como ha sido mi caso para los buzones de correo y recursos compartidos -, procederemos a configurarlos y montarlos en el servidor.</p>
<div class="admonition nota">
<p class="admonition-title">Nota</p>
<p>Para el punto de montaje de los recursos compartidos, se podría usar <code>/home/samba/</code> en lugar de <code>/home/</code>. No obstante, usando <code>/home/samba/</code> los directorios personales de los usuarios del dominio (compartidos en letra '<em>H</em>' por defecto) no quedarían almacenados en el volumen EBS.</p>
</div>
<ol>
<li>
<p>Listamos los volúmenes con el comando:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a>lsblk
</code></pre></div></td></tr></table></div>
<p>En mi caso concreto, me muestra el siguiente resultado:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span>
<span class="normal"><a href="#__codelineno-15-3">3</a></span>
<span class="normal"><a href="#__codelineno-15-4">4</a></span>
<span class="normal"><a href="#__codelineno-15-5">5</a></span>
<span class="normal"><a href="#__codelineno-15-6">6</a></span>
<span class="normal"><a href="#__codelineno-15-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a>NAME         MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
<a id="__codelineno-15-2" name="__codelineno-15-2"></a>nvme1n1      259:0    0   10G  0 disk
<a id="__codelineno-15-3" name="__codelineno-15-3"></a>nvme0n1      259:1    0   30G  0 disk
<a id="__codelineno-15-4" name="__codelineno-15-4"></a>├─nvme0n1p1  259:2    0 29.9G  0 part /
<a id="__codelineno-15-5" name="__codelineno-15-5"></a>├─nvme0n1p14 259:3    0    4M  0 part
<a id="__codelineno-15-6" name="__codelineno-15-6"></a>└─nvme0n1p15 259:4    0  106M  0 part /boot/efi
<a id="__codelineno-15-7" name="__codelineno-15-7"></a>nvme2n1      259:5    0   10G  0 disk
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>En los volúmenes <code>nvme1n1</code> y <code>nvme2n1</code> creamos una única partición que ocupe todo el disco:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span>
<span class="normal"><a href="#__codelineno-16-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="k">for</span><span class="w"> </span>disk<span class="w"> </span><span class="k">in</span><span class="w"> </span>nvme1n1<span class="w"> </span>nvme2n1<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s1">'n\np\n\n\n\nt\n8e\nw'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>fdisk<span class="w"> </span>/dev/<span class="nv">$disk</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="k">done</span>
</code></pre></div></td></tr></table></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>'8e' estable como etiqueta 'Linux' a la partición.</p>
</div>
</li>
<li>
<p>Revisamos que se hayan creado las particiones correctamente:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a>lsblk
</code></pre></div></td></tr></table></div>
<p>En mi caso concreto, me muestra el siguiente resultado:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span>
<span class="normal"><a href="#__codelineno-18-3">3</a></span>
<span class="normal"><a href="#__codelineno-18-4">4</a></span>
<span class="normal"><a href="#__codelineno-18-5">5</a></span>
<span class="normal"><a href="#__codelineno-18-6">6</a></span>
<span class="normal"><a href="#__codelineno-18-7">7</a></span>
<span class="normal"><a href="#__codelineno-18-8">8</a></span>
<span class="normal"><a href="#__codelineno-18-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a>NAME         MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
<a id="__codelineno-18-2" name="__codelineno-18-2"></a>nvme1n1      259:0    0   10G  0 disk
<a id="__codelineno-18-3" name="__codelineno-18-3"></a>└─nvme1n1p1  259:7    0   10G  0 part
<a id="__codelineno-18-4" name="__codelineno-18-4"></a>nvme0n1      259:1    0   30G  0 disk
<a id="__codelineno-18-5" name="__codelineno-18-5"></a>├─nvme0n1p1  259:2    0 29.9G  0 part /
<a id="__codelineno-18-6" name="__codelineno-18-6"></a>├─nvme0n1p14 259:3    0    4M  0 part
<a id="__codelineno-18-7" name="__codelineno-18-7"></a>└─nvme0n1p15 259:4    0  106M  0 part /boot/efi
<a id="__codelineno-18-8" name="__codelineno-18-8"></a>nvme2n1      259:5    0   10G  0 disk
<a id="__codelineno-18-9" name="__codelineno-18-9"></a>└─nvme2n1p1  259:8    0   10G  0 part
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Establecemos como sistema de archivos <code>ext4</code> a las nuevas particiones:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span>
<span class="normal"><a href="#__codelineno-19-2">2</a></span>
<span class="normal"><a href="#__codelineno-19-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="k">for</span><span class="w"> </span>disk<span class="w"> </span><span class="k">in</span><span class="w"> </span>nvme1n1p1<span class="w"> </span>nvme2n1p1<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="w">    </span>sudo<span class="w"> </span>mkfs<span class="w"> </span>-t<span class="w"> </span>ext4<span class="w"> </span>/dev/<span class="nv">$disk</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="k">done</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Volvemos a revisar que todo haya ido bien con el comando:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a>lsblk<span class="w"> </span>-f
</code></pre></div></td></tr></table></div>
<p>En mi caso concreto, me muestra el siguiente resultado:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span>
<span class="normal"><a href="#__codelineno-21-2">2</a></span>
<span class="normal"><a href="#__codelineno-21-3">3</a></span>
<span class="normal"><a href="#__codelineno-21-4">4</a></span>
<span class="normal"><a href="#__codelineno-21-5">5</a></span>
<span class="normal"><a href="#__codelineno-21-6">6</a></span>
<span class="normal"><a href="#__codelineno-21-7">7</a></span>
<span class="normal"><a href="#__codelineno-21-8">8</a></span>
<span class="normal"><a href="#__codelineno-21-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a>NAME         FSTYPE LABEL           UUID                                 FSAVAIL FSUSE% MOUNTPOINT
<a id="__codelineno-21-2" name="__codelineno-21-2"></a>nvme1n1
<a id="__codelineno-21-3" name="__codelineno-21-3"></a>└─nvme1n1p1  ext4                   28e5471e-8fc1-48b5-8729-778c56a19b90
<a id="__codelineno-21-4" name="__codelineno-21-4"></a>nvme0n1
<a id="__codelineno-21-5" name="__codelineno-21-5"></a>├─nvme0n1p1  ext4   cloudimg-rootfs 418a4763-c829-4fb6-b538-9a38158da803   26.8G     7% /
<a id="__codelineno-21-6" name="__codelineno-21-6"></a>├─nvme0n1p14
<a id="__codelineno-21-7" name="__codelineno-21-7"></a>└─nvme0n1p15 vfat   UEFI            CBF7-D252                              99.2M     5% /boot/efi
<a id="__codelineno-21-8" name="__codelineno-21-8"></a>nvme2n1
<a id="__codelineno-21-9" name="__codelineno-21-9"></a>└─nvme2n1p1  ext4                   e903ff6f-c431-4e3a-92a1-9f476c66b3be
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Creamos el directorio donde se montará el volumen EBS para los buzones de correo:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>-v<span class="w"> </span>-m0775<span class="w"> </span>/var/vmail
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Montamos temporalmente el volumen EBS que contendrá los recursos compartidos:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a>sudo<span class="w"> </span>mount<span class="w"> </span>/dev/nvme2n1p1<span class="w"> </span>/mnt
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Copiamos el contenido del directorio <code>/home/</code> al directorio temporal donde hemos montado el volumen EBS:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a>sudo<span class="w"> </span>cp<span class="w"> </span>-aR<span class="w"> </span>/home/*<span class="w"> </span>/mnt/
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Desmontamos el volumen EBS:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a>sudo<span class="w"> </span>umount<span class="w"> </span>/mnt
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Obtenemos el identificador (UUID) de los volúmenes:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a>sudo<span class="w"> </span>sudo<span class="w"> </span>blkid<span class="w"> </span><span class="p">|</span><span class="w"> </span>egrep<span class="w"> </span><span class="s2">"nvme[12]n1p1"</span>
</code></pre></div></td></tr></table></div>
<p>En mi caso concreto, me muestra el siguiente resultado:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span>
<span class="normal"><a href="#__codelineno-27-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a>/dev/nvme2n1p1:<span class="w"> </span><span class="nv">UUID</span><span class="o">=</span><span class="s2">"28e5471e-8fc1-48b5-8729-778c56a19b90"</span><span class="w"> </span><span class="nv">TYPE</span><span class="o">=</span><span class="s2">"ext4"</span><span class="w"> </span><span class="nv">PARTUUID</span><span class="o">=</span><span class="s2">"558dd3b7-01"</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a>/dev/nvme1n1p1:<span class="w"> </span><span class="nv">UUID</span><span class="o">=</span><span class="s2">"e903ff6f-c431-4e3a-92a1-9f476c66b3be"</span><span class="w"> </span><span class="nv">TYPE</span><span class="o">=</span><span class="s2">"ext4"</span><span class="w"> </span><span class="nv">PARTUUID</span><span class="o">=</span><span class="s2">"446d2929-01"</span>
</code></pre></div></td></tr></table></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Recordad que el volumen para los mailboxes fue montado primero, por lo que su punto de montaje es <code>/dev/nvme1n1p1</code>.</p>
</div>
</li>
<li>
<p>Establecemos en el archivo <code>/etc/fstab</code> el montaje de los volúmenes EBS:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span>
<span class="normal"><a href="#__codelineno-28-2">2</a></span>
<span class="normal"><a href="#__codelineno-28-3">3</a></span>
<span class="normal"><a href="#__codelineno-28-4">4</a></span>
<span class="normal"><a href="#__codelineno-28-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="c1">## AWS EBS - Mailboxes</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="nv">UUID</span><span class="o">=</span>e903ff6f-c431-4e3a-92a1-9f476c66b3be<span class="w"> </span>/var/vmail<span class="w"> </span>ext4<span class="w"> </span>defaults,noexec,nodev,nosuid<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">2</span>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="c1">## AWS EBS - Shares</span>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="nv">UUID</span><span class="o">=</span>28e5471e-8fc1-48b5-8729-778c56a19b90<span class="w"> </span>/home<span class="w"> </span>ext4<span class="w"> </span>defaults,noexec,nodev,nosuid<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">2</span>
</code></pre></div></td></tr></table></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Tendréis que cambiar el valor del parámetro <code>UUID</code> por vuestro valor obtenido en el paso 7.</p>
</div>
</li>
<li>
<p>Montamos los volúmenes para verificar que no hay errores de sintaxis en el archivo del paso anterior:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a>sudo<span class="w"> </span>mount<span class="w"> </span>-a
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Finalmente, confirmamos que se hayan montado bien ejecutando los siguientes comandos:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span>
<span class="normal"><a href="#__codelineno-30-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a>mount<span class="w"> </span><span class="p">|</span><span class="w"> </span>egrep<span class="w"> </span><span class="s1">'nvme[12]n1p1'</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a>df<span class="w"> </span>-h
</code></pre></div></td></tr></table></div>
<p>En mi caso concreto, me muestra el siguiente resultado:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-31-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-31-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-31-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-31-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-31-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-31-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-31-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-31-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-31-10">10</a></span>
<span class="normal"><a href="#__codelineno-31-11">11</a></span>
<span class="normal"><a href="#__codelineno-31-12">12</a></span>
<span class="normal"><a href="#__codelineno-31-13">13</a></span>
<span class="normal"><a href="#__codelineno-31-14">14</a></span>
<span class="normal"><a href="#__codelineno-31-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a>## Comando 'mount'
<a id="__codelineno-31-2" name="__codelineno-31-2"></a>/dev/nvme2n1p1 on /var/vmail type ext4 (rw,nosuid,nodev,noexec,relatime)
<a id="__codelineno-31-3" name="__codelineno-31-3"></a>/dev/nvme1n1p1 on /home type ext4 (rw,nosuid,nodev,noexec,relatime)
<a id="__codelineno-31-4" name="__codelineno-31-4"></a>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a>## Comando 'df'
<a id="__codelineno-31-6" name="__codelineno-31-6"></a>Filesystem       Size  Used Avail Use% Mounted on
<a id="__codelineno-31-7" name="__codelineno-31-7"></a>/dev/root         29G  7.9G   21G  28% /
<a id="__codelineno-31-8" name="__codelineno-31-8"></a>devtmpfs         1.9G     0  1.9G   0% /dev
<a id="__codelineno-31-9" name="__codelineno-31-9"></a>tmpfs            1.9G  4.0K  1.9G   1% /dev/shm
<a id="__codelineno-31-10" name="__codelineno-31-10"></a>tmpfs            388M  2.6M  386M   1% /run
<a id="__codelineno-31-11" name="__codelineno-31-11"></a>tmpfs            5.0M     0  5.0M   0% /run/lock
<a id="__codelineno-31-12" name="__codelineno-31-12"></a>tmpfs            1.9G     0  1.9G   0% /sys/fs/cgroup
<a id="__codelineno-31-13" name="__codelineno-31-13"></a>/dev/nvme2n1p1   9.8G   17M  9.3G   1% /var/vmail
<a id="__codelineno-31-14" name="__codelineno-31-14"></a>/dev/nvme1n1p1   9.8G  228K  9.3G   1% /home
<a id="__codelineno-31-15" name="__codelineno-31-15"></a>/dev/nvme0n1p15  105M  5.2M  100M   5% /boot/efi
</code></pre></div></td></tr></table></div>
</li>
</ol>
<h3 id="quota">Quota<a class="headerlink" href="#quota" title="Permanent link">¶</a></h3>
<p>Para poder hacer uso de las quotas que Zentyal permite establecer para limitar el uso de información que un usuario del dominio puede almacenar en el servidor, así como para el tamaño máximo del buzón de correo, es necesario instalar una serie de paquetes y habilitar su uso en el disco.</p>
<div class="admonition nota">
<p class="admonition-title">Nota</p>
<p>No es necesario habilitar la quota en el disco que contiene los buzones de correo, ya que Zentyal las gestiona de otra forma.</p>
</div>
<ol>
<li>
<p>Instalamos los siguientes paquetes requeridos para instancias de AWS:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1">1</a></span>
<span class="normal"><a href="#__codelineno-32-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>update
<a id="__codelineno-32-2" name="__codelineno-32-2"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>quota<span class="w"> </span>quotatool<span class="w"> </span>linux-modules-extra-aws
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Establecemos las opciones de montaje adicionales en el volumen EBS de los recursos compartidos, para ello, editamos el archivo de configuración <code>/etc/fstab</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">1</a></span>
<span class="normal"><a href="#__codelineno-33-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="c1">## AWS EBS - Shares</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="nv">UUID</span><span class="o">=</span>28e5471e-8fc1-48b5-8729-778c56a19b90<span class="w">   </span>/home<span class="w">   </span>ext4<span class="w">    </span>defaults,noexec,nodev,nosuid,usrjquota<span class="o">=</span>quota.user,grpjquota<span class="o">=</span>quota.group,jqfmt<span class="o">=</span>vfsv0<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">2</span>
</code></pre></div></td></tr></table></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Las opciones añadidas han sido: <code>usrjquota</code>, <code>grpjquota</code> y <code>jqfmt</code>.</p>
</div>
</li>
<li>
<p>Reiniciamos el servidor para que nos cargue el último kernel y podamos habilitar de forma seguridad las quotas:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a>sudo<span class="w"> </span>reboot
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Añadimos el módulo de Quota al kernel:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a>sudo<span class="w"> </span>modprobe<span class="w"> </span>quota_v2
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Persistimos el cambio anterior:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">'quota_v2'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/modules
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Dejamos que el sistema compruebe las quotas y cree los archivos pertinentes:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a>sudo<span class="w"> </span>quotacheck<span class="w"> </span>-vugmf<span class="w"> </span>/home
</code></pre></div></td></tr></table></div>
<p>El resultado que he obtenido en mi caso ha sido:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1">1</a></span>
<span class="normal"><a href="#__codelineno-38-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a>quotacheck: Scanning /dev/nvme1n1p1 [/home] done
<a id="__codelineno-38-2" name="__codelineno-38-2"></a>quotacheck: Checked 8 directories and 18 files
</code></pre></div></td></tr></table></div>
</li>
</ol>
<h2 id="configuracion-de-los-modulos">Configuración de los módulos<a class="headerlink" href="#configuracion-de-los-modulos" title="Permanent link">¶</a></h2>
<p>A partir de este momento, ya podremos instalar, configurar y comprobar los módulos de Zentyal.</p>
<h3 id="general">General<a class="headerlink" href="#general" title="Permanent link">¶</a></h3>
<p>Lo primero de todo que debemos hacer es configurar la base de Zentyal desde el menú <code>System -&gt; General</code>.</p>
<ol>
<li>
<p>Estableceremos el idioma del panel de administración así como el puerto por el cual escuchará el módulo <em>webadmin</em>:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/05-general-1.png"><img alt="Configuration of language and GUI port" src="../assets/zentyal/05-general-1.png" title="Configuration of language and GUI port"/></a></p>
</li>
<li>
<p>Después, desde el mismo panel, establecemos el nombre del servidor y el dominio:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/06-general-2.png"><img alt="Configuration of FQDN and domain" src="../assets/zentyal/06-general-2.png" title="Configuration of FQDN and domain"/></a></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>En el momento en que habilitemos el módulo de controlador de dominio, estos 2 valores no podrán cambiar.</p>
</div>
</li>
</ol>
<h3 id="modulo-de-logs">Módulo de Logs<a class="headerlink" href="#modulo-de-logs" title="Permanent link">¶</a></h3>
<p>Inicialmente, habilitaremos los '<em>dominios</em>' que hay disponibles, cambiaremos el tiempo de retención a 30 días para el firewall y 90 para los cambios del panel de administración así como login de los administradores:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/logs_initial.png"><img alt="Initial log configuration" src="../assets/zentyal/logs_initial.png" title="Initial log configuration"/></a></p>
<h3 id="modulo-de-cortafuegos">Módulo de Cortafuegos<a class="headerlink" href="#modulo-de-cortafuegos" title="Permanent link">¶</a></h3>
<p>Para la configuración de red que tenemos (interna) y los módulos que usaremos, las secciones del firewall que usaremos son:</p>
<ul>
<li>Filtering rules from internal networks to Zentyal</li>
<li>Filtering rules from traffic coming out from Zentyal</li>
</ul>
<p>Las políticas definidas por defecto en ambas secciones del firewall son seguras, no obstante, procederemos a añadir una regla de tipo <code>LOG</code> para las conexiones por SSH, ya que siempre es buena idea tener la mayor información posible sobre este servicio tan crítico. Para ello, iremos a <code>Firewall -&gt; Packet Filter -&gt; Filtering rules from internal networks to Zentyal</code> y añadiremos la siguiente regla:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/firewall_initial-ssh-1.png"><img alt="Firewall SSH rule 1" src="../assets/zentyal/firewall_initial-ssh-1.png" title="Firewall SSH rule 1"/></a></p>
<p>Quedando como resultado las siguientes reglas:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/firewall_initial-ssh-2.png"><img alt="Firewall SSH rule 2" src="../assets/zentyal/firewall_initial-ssh-2.png" title="Firewall SSH rule 2"/></a></p>
<p><strong>Consideraciones:</strong></p>
<ol>
<li>Es importante que la nueva regla vaya por encima de la regla que acepta la conexión SSH, de lo contrario nunca se ejecutará, ya que cuando una regla se cumple, no se siguen analizando el resto.</li>
<li>Recordad que a parte de este firewall, también tenemos el de AWS (Security Group asociado a la instancia), por lo que tendremos que asegurarnos que ambos firewall tienen las mismas reglas.</li>
<li>Se podría configurar en el firewall de Zentyal que permita todo el tráfico y después, desde el security group ser más restrictivo, o viceversa, no obstante, es recomendable configurar ambos por igual.</li>
</ol>
<h3 id="modulo-de-software">Módulo de Software<a class="headerlink" href="#modulo-de-software" title="Permanent link">¶</a></h3>
<p>Con la finalidad de tener nuestro servidor actualizado, habilitaremos y estableceremos la hora en la que se instalarán las actualizaciones automáticamente. Además, procederemos a instalar los módulos que vamos a usar.</p>
<ol>
<li>
<p>Desde el menú <code>Software Management -&gt; Settings</code>, establecemos las configuraciones de las actualizaciones automáticas:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/software_automatic-updates.png"><img alt="Automatic software updates" src="../assets/zentyal/software_automatic-updates.png" title="Automatic software updates"/></a></p>
<div class="admonition nota">
<p class="admonition-title">Nota</p>
<p>Es altamente recomendable establecer una hora que sea posterior a las copias de seguridad del servidor como snapshots, así tenemos un punto de restauración estable en caso de que una actualización cause una incidencia crítica.</p>
</div>
</li>
<li>
<p>Después, desde el menú <code>Software Management -&gt; Zentyal Components</code> procederemos a instalar <strong>únicamente</strong> los módulos que vamos a usar:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/software_installation.png"><img alt="Modules installation" src="../assets/zentyal/software_installation.png" title="Modules installation"/></a></p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Tras instalarse los módulos, se crearán automáticamente múltiples reglas en la sección <code>Filtering rules from internal networks to Zentyal</code> del firewall para permitir el accesos a estos módulos.</p>
</div>
</li>
</ol>
<h3 id="modulo-de-ntp">Módulo de NTP<a class="headerlink" href="#modulo-de-ntp" title="Permanent link">¶</a></h3>
<p>El primero de los módulos recién instalado que vamos a configurar es <a href="https://doc.zentyal.org/es/ntp.html">NTP</a>, en él estableceremos la zona horaria y los servidores NTP oficiales más próximos geográficamente donde está ubicado el servidor.</p>
<ol>
<li>
<p>Vamos a <code>System -&gt; Date/Time</code> y establecemos la zona horaria:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/ntp_timezone.png"><img alt="NTP timezone" src="../assets/zentyal/ntp_timezone.png" title="NTP timezone"/></a></p>
</li>
<li>
<p>Habilitamos la opción que permite sincronizar la hora con servidores externos:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/ntp_sync.png"><img alt="NTP sync option" src="../assets/zentyal/ntp_sync.png" title="NTP sync option"/></a></p>
</li>
<li>
<p>Modificamos los servidores NTP establecidos por defecto, por los oficiales que tenemos disponibles en <a href="https://www.pool.ntp.org/en">esta</a> web:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/ntp_servers.png"><img alt="NTP servers" src="../assets/zentyal/ntp_servers.png" title="NTP servers"/></a></p>
</li>
<li>
<p>Finalmente, habilitamos el módulo de NTP desde <code>Modules Status</code>:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/modules_ntp.png"><img alt="NTP enable" src="../assets/zentyal/modules_ntp.png" title="NTP enable"/></a></p>
</li>
</ol>
<h3 id="modulo-de-dns">Módulo de DNS<a class="headerlink" href="#modulo-de-dns" title="Permanent link">¶</a></h3>
<p>El siguiente módulo que procederemos a configurar será el <a href="https://doc.zentyal.org/es/dns.html">DNS</a>, el cual es crítico para el funcionamiento del módulo de controlador de dominio y por dependencia, también el de correo.</p>
<p>La configuración que estableceremos será mínima, ya que la gestión de los registros DNS la gestionaremos desde el panel de administración donde tenemos contratado el dominio - Route 53 en mi caso -.</p>
<ol>
<li>
<p>Creamos el dominio, el cual debe coincidir con el creado en <code>System -&gt; General</code>. Para ello, desde el menú lateral seleccionamos <code>DNS</code>:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/dns-new_domain.png"><img alt="DNS new domain" src="../assets/zentyal/dns-new_domain.png" title="DNS new domain"/></a></p>
</li>
<li>
<p>Después, comprobamos que la IP del servidor se haya registrado con éxito al dominio, para ello vamos al campo <code>Domain IP Addresses</code> del dominio recién creado:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/dns-domain_record.png"><img alt="DNS domain record" src="../assets/zentyal/dns-domain_record.png" title="DNS domain record"/></a></p>
</li>
<li>
<p>También revisamos que la IP se haya registrado para el nombre del servidor. En este caso, el campo es <code>Hostnames -&gt; IP Address</code>:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/dns-hostname_record.png"><img alt="DNS hostname record" src="../assets/zentyal/dns-hostname_record.png" title="DNS hostname record"/></a></p>
</li>
<li>
<p>A continuación, creamos los registros adicionales de tipo alias desde <code>Hostnames -&gt; Alias</code>. En mi caso, crearé dos registros relativos al correo: <code>mail</code> y <code>webmail</code>.</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/dns-alias.png"><img alt="DNS alias records" src="../assets/zentyal/dns-alias.png" title="DNS alias records"/></a></p>
</li>
<li>
<p>Establecemos los servidores DNS forwarders, que en caso serán los de <a href="https://www.cloudflare.com/es-es/">Cloudflare</a> y <a href="https://www.quad9.net/es/">Quad9</a>:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/dns-forwarders.png"><img alt="DNS forwarders" src="../assets/zentyal/dns-forwarders.png" title="DNS forwarders"/></a></p>
</li>
<li>
<p>Una ves establecida la configuración del módulo, procederemos a habilitarlo desde <code>Modules Status</code>:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/modules_dns.png"><img alt="DNS enable" src="../assets/zentyal/modules_dns.png" title="DNS enable"/></a></p>
</li>
<li>
<p>Finalmente, comprobamos que podemos resolver los registros DNS configurados desde el propio servidor. Para ello, ejecutaremos los siguientes comandos:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1">1</a></span>
<span class="normal"><a href="#__codelineno-39-2">2</a></span>
<span class="normal"><a href="#__codelineno-39-3">3</a></span>
<span class="normal"><a href="#__codelineno-39-4">4</a></span>
<span class="normal"><a href="#__codelineno-39-5">5</a></span>
<span class="normal"><a href="#__codelineno-39-6">6</a></span>
<span class="normal"><a href="#__codelineno-39-7">7</a></span>
<span class="normal"><a href="#__codelineno-39-8">8</a></span>
<span class="normal"><a href="#__codelineno-39-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="c1">## Para el dominio</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a>dig<span class="w"> </span>icecrown.es
<a id="__codelineno-39-3" name="__codelineno-39-3"></a>
<a id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="c1">## Para el nombre del servidor</span>
<a id="__codelineno-39-5" name="__codelineno-39-5"></a>dig<span class="w"> </span>arthas.icecrown.es
<a id="__codelineno-39-6" name="__codelineno-39-6"></a>
<a id="__codelineno-39-7" name="__codelineno-39-7"></a><span class="c1">## Para los alias</span>
<a id="__codelineno-39-8" name="__codelineno-39-8"></a>dig<span class="w"> </span>mail.icecrown.es
<a id="__codelineno-39-9" name="__codelineno-39-9"></a>dig<span class="w"> </span>webmail.icecrown.es
</code></pre></div></td></tr></table></div>
<p>A continuación, los resultados que he obtenido:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-40-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-40-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-40-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-40-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-40-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-40-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-40-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-40-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-40-10">10</a></span>
<span class="normal"><a href="#__codelineno-40-11">11</a></span>
<span class="normal"><a href="#__codelineno-40-12">12</a></span>
<span class="normal"><a href="#__codelineno-40-13">13</a></span>
<span class="normal"><a href="#__codelineno-40-14">14</a></span>
<span class="normal"><a href="#__codelineno-40-15">15</a></span>
<span class="normal"><a href="#__codelineno-40-16">16</a></span>
<span class="normal"><a href="#__codelineno-40-17">17</a></span>
<span class="normal"><a href="#__codelineno-40-18">18</a></span>
<span class="normal"><a href="#__codelineno-40-19">19</a></span>
<span class="normal"><a href="#__codelineno-40-20">20</a></span>
<span class="normal"><a href="#__codelineno-40-21">21</a></span>
<span class="normal"><a href="#__codelineno-40-22">22</a></span>
<span class="normal"><a href="#__codelineno-40-23">23</a></span>
<span class="normal"><a href="#__codelineno-40-24">24</a></span>
<span class="normal"><a href="#__codelineno-40-25">25</a></span>
<span class="normal"><a href="#__codelineno-40-26">26</a></span>
<span class="normal"><a href="#__codelineno-40-27">27</a></span>
<span class="normal"><a href="#__codelineno-40-28">28</a></span>
<span class="normal"><a href="#__codelineno-40-29">29</a></span>
<span class="normal"><a href="#__codelineno-40-30">30</a></span>
<span class="normal"><a href="#__codelineno-40-31">31</a></span>
<span class="normal"><a href="#__codelineno-40-32">32</a></span>
<span class="normal"><a href="#__codelineno-40-33">33</a></span>
<span class="normal"><a href="#__codelineno-40-34">34</a></span>
<span class="normal"><a href="#__codelineno-40-35">35</a></span>
<span class="normal"><a href="#__codelineno-40-36">36</a></span>
<span class="normal"><a href="#__codelineno-40-37">37</a></span>
<span class="normal"><a href="#__codelineno-40-38">38</a></span>
<span class="normal"><a href="#__codelineno-40-39">39</a></span>
<span class="normal"><a href="#__codelineno-40-40">40</a></span>
<span class="normal"><a href="#__codelineno-40-41">41</a></span>
<span class="normal"><a href="#__codelineno-40-42">42</a></span>
<span class="normal"><a href="#__codelineno-40-43">43</a></span>
<span class="normal"><a href="#__codelineno-40-44">44</a></span>
<span class="normal"><a href="#__codelineno-40-45">45</a></span>
<span class="normal"><a href="#__codelineno-40-46">46</a></span>
<span class="normal"><a href="#__codelineno-40-47">47</a></span>
<span class="normal"><a href="#__codelineno-40-48">48</a></span>
<span class="normal"><a href="#__codelineno-40-49">49</a></span>
<span class="normal"><a href="#__codelineno-40-50">50</a></span>
<span class="normal"><a href="#__codelineno-40-51">51</a></span>
<span class="normal"><a href="#__codelineno-40-52">52</a></span>
<span class="normal"><a href="#__codelineno-40-53">53</a></span>
<span class="normal"><a href="#__codelineno-40-54">54</a></span>
<span class="normal"><a href="#__codelineno-40-55">55</a></span>
<span class="normal"><a href="#__codelineno-40-56">56</a></span>
<span class="normal"><a href="#__codelineno-40-57">57</a></span>
<span class="normal"><a href="#__codelineno-40-58">58</a></span>
<span class="normal"><a href="#__codelineno-40-59">59</a></span>
<span class="normal"><a href="#__codelineno-40-60">60</a></span>
<span class="normal"><a href="#__codelineno-40-61">61</a></span>
<span class="normal"><a href="#__codelineno-40-62">62</a></span>
<span class="normal"><a href="#__codelineno-40-63">63</a></span>
<span class="normal"><a href="#__codelineno-40-64">64</a></span>
<span class="normal"><a href="#__codelineno-40-65">65</a></span>
<span class="normal"><a href="#__codelineno-40-66">66</a></span>
<span class="normal"><a href="#__codelineno-40-67">67</a></span>
<span class="normal"><a href="#__codelineno-40-68">68</a></span>
<span class="normal"><a href="#__codelineno-40-69">69</a></span>
<span class="normal"><a href="#__codelineno-40-70">70</a></span>
<span class="normal"><a href="#__codelineno-40-71">71</a></span>
<span class="normal"><a href="#__codelineno-40-72">72</a></span>
<span class="normal"><a href="#__codelineno-40-73">73</a></span>
<span class="normal"><a href="#__codelineno-40-74">74</a></span>
<span class="normal"><a href="#__codelineno-40-75">75</a></span>
<span class="normal"><a href="#__codelineno-40-76">76</a></span>
<span class="normal"><a href="#__codelineno-40-77">77</a></span>
<span class="normal"><a href="#__codelineno-40-78">78</a></span>
<span class="normal"><a href="#__codelineno-40-79">79</a></span>
<span class="normal"><a href="#__codelineno-40-80">80</a></span>
<span class="normal"><a href="#__codelineno-40-81">81</a></span>
<span class="normal"><a href="#__codelineno-40-82">82</a></span>
<span class="normal"><a href="#__codelineno-40-83">83</a></span>
<span class="normal"><a href="#__codelineno-40-84">84</a></span>
<span class="normal"><a href="#__codelineno-40-85">85</a></span>
<span class="normal"><a href="#__codelineno-40-86">86</a></span>
<span class="normal"><a href="#__codelineno-40-87">87</a></span>
<span class="normal"><a href="#__codelineno-40-88">88</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a>## Para el dominio
<a id="__codelineno-40-2" name="__codelineno-40-2"></a>; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; icecrown.es
<a id="__codelineno-40-3" name="__codelineno-40-3"></a>;; global options: +cmd
<a id="__codelineno-40-4" name="__codelineno-40-4"></a>;; Got answer:
<a id="__codelineno-40-5" name="__codelineno-40-5"></a>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 11829
<a id="__codelineno-40-6" name="__codelineno-40-6"></a>;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1
<a id="__codelineno-40-7" name="__codelineno-40-7"></a>
<a id="__codelineno-40-8" name="__codelineno-40-8"></a>;; OPT PSEUDOSECTION:
<a id="__codelineno-40-9" name="__codelineno-40-9"></a>; EDNS: version: 0, flags:; udp: 4096
<a id="__codelineno-40-10" name="__codelineno-40-10"></a>; COOKIE: 517f093b1a488a630100000063ef1e5f33c655878c47e480 (good)
<a id="__codelineno-40-11" name="__codelineno-40-11"></a>;; QUESTION SECTION:
<a id="__codelineno-40-12" name="__codelineno-40-12"></a>;icecrown.es.           IN  A
<a id="__codelineno-40-13" name="__codelineno-40-13"></a>
<a id="__codelineno-40-14" name="__codelineno-40-14"></a>;; ANSWER SECTION:
<a id="__codelineno-40-15" name="__codelineno-40-15"></a>icecrown.es.        259200  IN  A   10.0.1.200
<a id="__codelineno-40-16" name="__codelineno-40-16"></a>
<a id="__codelineno-40-17" name="__codelineno-40-17"></a>;; Query time: 0 msec
<a id="__codelineno-40-18" name="__codelineno-40-18"></a>;; SERVER: 127.0.0.1#53(127.0.0.1)
<a id="__codelineno-40-19" name="__codelineno-40-19"></a>;; WHEN: Fri Feb 17 07:27:43 CET 2023
<a id="__codelineno-40-20" name="__codelineno-40-20"></a>;; MSG SIZE  rcvd: 84
<a id="__codelineno-40-21" name="__codelineno-40-21"></a>
<a id="__codelineno-40-22" name="__codelineno-40-22"></a>
<a id="__codelineno-40-23" name="__codelineno-40-23"></a>## Para el nombre del servidor
<a id="__codelineno-40-24" name="__codelineno-40-24"></a>; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; arthas.icecrown.es
<a id="__codelineno-40-25" name="__codelineno-40-25"></a>;; global options: +cmd
<a id="__codelineno-40-26" name="__codelineno-40-26"></a>;; Got answer:
<a id="__codelineno-40-27" name="__codelineno-40-27"></a>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 53740
<a id="__codelineno-40-28" name="__codelineno-40-28"></a>;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1
<a id="__codelineno-40-29" name="__codelineno-40-29"></a>
<a id="__codelineno-40-30" name="__codelineno-40-30"></a>;; OPT PSEUDOSECTION:
<a id="__codelineno-40-31" name="__codelineno-40-31"></a>; EDNS: version: 0, flags:; udp: 4096
<a id="__codelineno-40-32" name="__codelineno-40-32"></a>; COOKIE: 0a10fe5bc110fbe20100000063ef1e79cd9a2652e62e1cba (good)
<a id="__codelineno-40-33" name="__codelineno-40-33"></a>;; QUESTION SECTION:
<a id="__codelineno-40-34" name="__codelineno-40-34"></a>;arthas.icecrown.es.        IN  A
<a id="__codelineno-40-35" name="__codelineno-40-35"></a>
<a id="__codelineno-40-36" name="__codelineno-40-36"></a>;; ANSWER SECTION:
<a id="__codelineno-40-37" name="__codelineno-40-37"></a>arthas.icecrown.es. 259200  IN  A   10.0.1.200
<a id="__codelineno-40-38" name="__codelineno-40-38"></a>
<a id="__codelineno-40-39" name="__codelineno-40-39"></a>;; Query time: 0 msec
<a id="__codelineno-40-40" name="__codelineno-40-40"></a>;; SERVER: 127.0.0.1#53(127.0.0.1)
<a id="__codelineno-40-41" name="__codelineno-40-41"></a>;; WHEN: Fri Feb 17 07:28:09 CET 2023
<a id="__codelineno-40-42" name="__codelineno-40-42"></a>;; MSG SIZE  rcvd: 91
<a id="__codelineno-40-43" name="__codelineno-40-43"></a>
<a id="__codelineno-40-44" name="__codelineno-40-44"></a>
<a id="__codelineno-40-45" name="__codelineno-40-45"></a>## Para el alias 'mail'
<a id="__codelineno-40-46" name="__codelineno-40-46"></a>; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; mail.icecrown.es
<a id="__codelineno-40-47" name="__codelineno-40-47"></a>;; global options: +cmd
<a id="__codelineno-40-48" name="__codelineno-40-48"></a>;; Got answer:
<a id="__codelineno-40-49" name="__codelineno-40-49"></a>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 62966
<a id="__codelineno-40-50" name="__codelineno-40-50"></a>;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1
<a id="__codelineno-40-51" name="__codelineno-40-51"></a>
<a id="__codelineno-40-52" name="__codelineno-40-52"></a>;; OPT PSEUDOSECTION:
<a id="__codelineno-40-53" name="__codelineno-40-53"></a>; EDNS: version: 0, flags:; udp: 4096
<a id="__codelineno-40-54" name="__codelineno-40-54"></a>; COOKIE: c5ac7f415fe066aa0100000063ef1e9c7e18da9abf7650f1 (good)
<a id="__codelineno-40-55" name="__codelineno-40-55"></a>;; QUESTION SECTION:
<a id="__codelineno-40-56" name="__codelineno-40-56"></a>;mail.icecrown.es.      IN  A
<a id="__codelineno-40-57" name="__codelineno-40-57"></a>
<a id="__codelineno-40-58" name="__codelineno-40-58"></a>;; ANSWER SECTION:
<a id="__codelineno-40-59" name="__codelineno-40-59"></a>mail.icecrown.es.   259200  IN  CNAME   arthas.icecrown.es.
<a id="__codelineno-40-60" name="__codelineno-40-60"></a>arthas.icecrown.es. 259200  IN  A   10.0.1.200
<a id="__codelineno-40-61" name="__codelineno-40-61"></a>
<a id="__codelineno-40-62" name="__codelineno-40-62"></a>;; Query time: 0 msec
<a id="__codelineno-40-63" name="__codelineno-40-63"></a>;; SERVER: 127.0.0.1#53(127.0.0.1)
<a id="__codelineno-40-64" name="__codelineno-40-64"></a>;; WHEN: Fri Feb 17 07:28:44 CET 2023
<a id="__codelineno-40-65" name="__codelineno-40-65"></a>;; MSG SIZE  rcvd: 110
<a id="__codelineno-40-66" name="__codelineno-40-66"></a>
<a id="__codelineno-40-67" name="__codelineno-40-67"></a>
<a id="__codelineno-40-68" name="__codelineno-40-68"></a>## Para el alias 'webmail'
<a id="__codelineno-40-69" name="__codelineno-40-69"></a>; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; webmail.icecrown.es
<a id="__codelineno-40-70" name="__codelineno-40-70"></a>;; global options: +cmd
<a id="__codelineno-40-71" name="__codelineno-40-71"></a>;; Got answer:
<a id="__codelineno-40-72" name="__codelineno-40-72"></a>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 40072
<a id="__codelineno-40-73" name="__codelineno-40-73"></a>;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1
<a id="__codelineno-40-74" name="__codelineno-40-74"></a>
<a id="__codelineno-40-75" name="__codelineno-40-75"></a>;; OPT PSEUDOSECTION:
<a id="__codelineno-40-76" name="__codelineno-40-76"></a>; EDNS: version: 0, flags:; udp: 4096
<a id="__codelineno-40-77" name="__codelineno-40-77"></a>; COOKIE: a1ff85fe806432700100000063ef1eb9ff2777f239f7c9a3 (good)
<a id="__codelineno-40-78" name="__codelineno-40-78"></a>;; QUESTION SECTION:
<a id="__codelineno-40-79" name="__codelineno-40-79"></a>;webmail.icecrown.es.       IN  A
<a id="__codelineno-40-80" name="__codelineno-40-80"></a>
<a id="__codelineno-40-81" name="__codelineno-40-81"></a>;; ANSWER SECTION:
<a id="__codelineno-40-82" name="__codelineno-40-82"></a>webmail.icecrown.es.    259200  IN  CNAME   arthas.icecrown.es.
<a id="__codelineno-40-83" name="__codelineno-40-83"></a>arthas.icecrown.es. 259200  IN  A   10.0.1.200
<a id="__codelineno-40-84" name="__codelineno-40-84"></a>
<a id="__codelineno-40-85" name="__codelineno-40-85"></a>;; Query time: 0 msec
<a id="__codelineno-40-86" name="__codelineno-40-86"></a>;; SERVER: 127.0.0.1#53(127.0.0.1)
<a id="__codelineno-40-87" name="__codelineno-40-87"></a>;; WHEN: Fri Feb 17 07:29:13 CET 2023
<a id="__codelineno-40-88" name="__codelineno-40-88"></a>;; MSG SIZE  rcvd: 113
</code></pre></div></td></tr></table></div>
<p>Como se puede apreciar, el <code>status</code> de todos es '<strong>NOERROR</strong>' y en '<strong>ANSWER SECTION</strong>' muestra los registros DNS en cuestión.</p>
</li>
</ol>
<p>Llegados a este punto, el módulo estaría configurado en Zentyal, no obstante, todavía queda crear los registros con la IP pública del servidor en el proveedor DNS para que estos sean visibles externamente. A continuación los pasos a realizar para AWS Route53:</p>
<ol>
<li>
<p>Vamos a <code>Route 53 -&gt; Hosted zones -&gt; dominio</code> y creamos los mismos registros que en Zentyal pero con la IP pública:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/dns-route53_records.png"><img alt="DNS Route53 domain records" src="../assets/zentyal/dns-route53_records.png" title="DNS Route53 domain records"/></a></p>
</li>
<li>
<p>Esperamos unos minutos para que puedan replicarse globalmente.</p>
</li>
<li>
<p>Finalmente, comprobamos la resolución de los registros:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1">1</a></span>
<span class="normal"><a href="#__codelineno-41-2">2</a></span>
<span class="normal"><a href="#__codelineno-41-3">3</a></span>
<span class="normal"><a href="#__codelineno-41-4">4</a></span>
<span class="normal"><a href="#__codelineno-41-5">5</a></span>
<span class="normal"><a href="#__codelineno-41-6">6</a></span>
<span class="normal"><a href="#__codelineno-41-7">7</a></span>
<span class="normal"><a href="#__codelineno-41-8">8</a></span>
<span class="normal"><a href="#__codelineno-41-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="c1">## Para el dominio</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a>dig<span class="w"> </span>@8.8.8.8<span class="w"> </span>icecrown.es
<a id="__codelineno-41-3" name="__codelineno-41-3"></a>
<a id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="c1">## Para el nombre del servidor</span>
<a id="__codelineno-41-5" name="__codelineno-41-5"></a>dig<span class="w"> </span>@8.8.8.8<span class="w"> </span>arthas.icecrown.es
<a id="__codelineno-41-6" name="__codelineno-41-6"></a>
<a id="__codelineno-41-7" name="__codelineno-41-7"></a><span class="c1">## Para los alias</span>
<a id="__codelineno-41-8" name="__codelineno-41-8"></a>dig<span class="w"> </span>@8.8.8.8<span class="w"> </span>mail.icecrown.es
<a id="__codelineno-41-9" name="__codelineno-41-9"></a>dig<span class="w"> </span>@8.8.8.8<span class="w"> </span>webmail.icecrown.es
</code></pre></div></td></tr></table></div>
<p>A continuación, los resultados que he obtenido:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-42-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-42-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-42-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-42-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-42-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-42-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-42-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-42-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-42-10">10</a></span>
<span class="normal"><a href="#__codelineno-42-11">11</a></span>
<span class="normal"><a href="#__codelineno-42-12">12</a></span>
<span class="normal"><a href="#__codelineno-42-13">13</a></span>
<span class="normal"><a href="#__codelineno-42-14">14</a></span>
<span class="normal"><a href="#__codelineno-42-15">15</a></span>
<span class="normal"><a href="#__codelineno-42-16">16</a></span>
<span class="normal"><a href="#__codelineno-42-17">17</a></span>
<span class="normal"><a href="#__codelineno-42-18">18</a></span>
<span class="normal"><a href="#__codelineno-42-19">19</a></span>
<span class="normal"><a href="#__codelineno-42-20">20</a></span>
<span class="normal"><a href="#__codelineno-42-21">21</a></span>
<span class="normal"><a href="#__codelineno-42-22">22</a></span>
<span class="normal"><a href="#__codelineno-42-23">23</a></span>
<span class="normal"><a href="#__codelineno-42-24">24</a></span>
<span class="normal"><a href="#__codelineno-42-25">25</a></span>
<span class="normal"><a href="#__codelineno-42-26">26</a></span>
<span class="normal"><a href="#__codelineno-42-27">27</a></span>
<span class="normal"><a href="#__codelineno-42-28">28</a></span>
<span class="normal"><a href="#__codelineno-42-29">29</a></span>
<span class="normal"><a href="#__codelineno-42-30">30</a></span>
<span class="normal"><a href="#__codelineno-42-31">31</a></span>
<span class="normal"><a href="#__codelineno-42-32">32</a></span>
<span class="normal"><a href="#__codelineno-42-33">33</a></span>
<span class="normal"><a href="#__codelineno-42-34">34</a></span>
<span class="normal"><a href="#__codelineno-42-35">35</a></span>
<span class="normal"><a href="#__codelineno-42-36">36</a></span>
<span class="normal"><a href="#__codelineno-42-37">37</a></span>
<span class="normal"><a href="#__codelineno-42-38">38</a></span>
<span class="normal"><a href="#__codelineno-42-39">39</a></span>
<span class="normal"><a href="#__codelineno-42-40">40</a></span>
<span class="normal"><a href="#__codelineno-42-41">41</a></span>
<span class="normal"><a href="#__codelineno-42-42">42</a></span>
<span class="normal"><a href="#__codelineno-42-43">43</a></span>
<span class="normal"><a href="#__codelineno-42-44">44</a></span>
<span class="normal"><a href="#__codelineno-42-45">45</a></span>
<span class="normal"><a href="#__codelineno-42-46">46</a></span>
<span class="normal"><a href="#__codelineno-42-47">47</a></span>
<span class="normal"><a href="#__codelineno-42-48">48</a></span>
<span class="normal"><a href="#__codelineno-42-49">49</a></span>
<span class="normal"><a href="#__codelineno-42-50">50</a></span>
<span class="normal"><a href="#__codelineno-42-51">51</a></span>
<span class="normal"><a href="#__codelineno-42-52">52</a></span>
<span class="normal"><a href="#__codelineno-42-53">53</a></span>
<span class="normal"><a href="#__codelineno-42-54">54</a></span>
<span class="normal"><a href="#__codelineno-42-55">55</a></span>
<span class="normal"><a href="#__codelineno-42-56">56</a></span>
<span class="normal"><a href="#__codelineno-42-57">57</a></span>
<span class="normal"><a href="#__codelineno-42-58">58</a></span>
<span class="normal"><a href="#__codelineno-42-59">59</a></span>
<span class="normal"><a href="#__codelineno-42-60">60</a></span>
<span class="normal"><a href="#__codelineno-42-61">61</a></span>
<span class="normal"><a href="#__codelineno-42-62">62</a></span>
<span class="normal"><a href="#__codelineno-42-63">63</a></span>
<span class="normal"><a href="#__codelineno-42-64">64</a></span>
<span class="normal"><a href="#__codelineno-42-65">65</a></span>
<span class="normal"><a href="#__codelineno-42-66">66</a></span>
<span class="normal"><a href="#__codelineno-42-67">67</a></span>
<span class="normal"><a href="#__codelineno-42-68">68</a></span>
<span class="normal"><a href="#__codelineno-42-69">69</a></span>
<span class="normal"><a href="#__codelineno-42-70">70</a></span>
<span class="normal"><a href="#__codelineno-42-71">71</a></span>
<span class="normal"><a href="#__codelineno-42-72">72</a></span>
<span class="normal"><a href="#__codelineno-42-73">73</a></span>
<span class="normal"><a href="#__codelineno-42-74">74</a></span>
<span class="normal"><a href="#__codelineno-42-75">75</a></span>
<span class="normal"><a href="#__codelineno-42-76">76</a></span>
<span class="normal"><a href="#__codelineno-42-77">77</a></span>
<span class="normal"><a href="#__codelineno-42-78">78</a></span>
<span class="normal"><a href="#__codelineno-42-79">79</a></span>
<span class="normal"><a href="#__codelineno-42-80">80</a></span>
<span class="normal"><a href="#__codelineno-42-81">81</a></span>
<span class="normal"><a href="#__codelineno-42-82">82</a></span>
<span class="normal"><a href="#__codelineno-42-83">83</a></span>
<span class="normal"><a href="#__codelineno-42-84">84</a></span>
<span class="normal"><a href="#__codelineno-42-85">85</a></span>
<span class="normal"><a href="#__codelineno-42-86">86</a></span>
<span class="normal"><a href="#__codelineno-42-87">87</a></span>
<span class="normal"><a href="#__codelineno-42-88">88</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a>## Para el dominio
<a id="__codelineno-42-2" name="__codelineno-42-2"></a>; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; @8.8.8.8 icecrown.es
<a id="__codelineno-42-3" name="__codelineno-42-3"></a>; (1 server found)
<a id="__codelineno-42-4" name="__codelineno-42-4"></a>;; global options: +cmd
<a id="__codelineno-42-5" name="__codelineno-42-5"></a>;; Got answer:
<a id="__codelineno-42-6" name="__codelineno-42-6"></a>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 7888
<a id="__codelineno-42-7" name="__codelineno-42-7"></a>;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1
<a id="__codelineno-42-8" name="__codelineno-42-8"></a>
<a id="__codelineno-42-9" name="__codelineno-42-9"></a>;; OPT PSEUDOSECTION:
<a id="__codelineno-42-10" name="__codelineno-42-10"></a>; EDNS: version: 0, flags:; udp: 512
<a id="__codelineno-42-11" name="__codelineno-42-11"></a>;; QUESTION SECTION:
<a id="__codelineno-42-12" name="__codelineno-42-12"></a>;icecrown.es.           IN  A
<a id="__codelineno-42-13" name="__codelineno-42-13"></a>
<a id="__codelineno-42-14" name="__codelineno-42-14"></a>;; ANSWER SECTION:
<a id="__codelineno-42-15" name="__codelineno-42-15"></a>icecrown.es.        60  IN  A   15.237.168.75
<a id="__codelineno-42-16" name="__codelineno-42-16"></a>
<a id="__codelineno-42-17" name="__codelineno-42-17"></a>;; Query time: 16 msec
<a id="__codelineno-42-18" name="__codelineno-42-18"></a>;; SERVER: 8.8.8.8#53(8.8.8.8)
<a id="__codelineno-42-19" name="__codelineno-42-19"></a>;; WHEN: Fri Feb 17 07:30:36 CET 2023
<a id="__codelineno-42-20" name="__codelineno-42-20"></a>;; MSG SIZE  rcvd: 56
<a id="__codelineno-42-21" name="__codelineno-42-21"></a>
<a id="__codelineno-42-22" name="__codelineno-42-22"></a>
<a id="__codelineno-42-23" name="__codelineno-42-23"></a>## Para el nombre del servidor
<a id="__codelineno-42-24" name="__codelineno-42-24"></a>; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; @8.8.8.8 arthas.icecrown.es
<a id="__codelineno-42-25" name="__codelineno-42-25"></a>; (1 server found)
<a id="__codelineno-42-26" name="__codelineno-42-26"></a>;; global options: +cmd
<a id="__codelineno-42-27" name="__codelineno-42-27"></a>;; Got answer:
<a id="__codelineno-42-28" name="__codelineno-42-28"></a>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 33376
<a id="__codelineno-42-29" name="__codelineno-42-29"></a>;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1
<a id="__codelineno-42-30" name="__codelineno-42-30"></a>
<a id="__codelineno-42-31" name="__codelineno-42-31"></a>;; OPT PSEUDOSECTION:
<a id="__codelineno-42-32" name="__codelineno-42-32"></a>; EDNS: version: 0, flags:; udp: 512
<a id="__codelineno-42-33" name="__codelineno-42-33"></a>;; QUESTION SECTION:
<a id="__codelineno-42-34" name="__codelineno-42-34"></a>;arthas.icecrown.es.        IN  A
<a id="__codelineno-42-35" name="__codelineno-42-35"></a>
<a id="__codelineno-42-36" name="__codelineno-42-36"></a>;; ANSWER SECTION:
<a id="__codelineno-42-37" name="__codelineno-42-37"></a>arthas.icecrown.es. 120 IN  A   15.237.168.75
<a id="__codelineno-42-38" name="__codelineno-42-38"></a>
<a id="__codelineno-42-39" name="__codelineno-42-39"></a>;; Query time: 36 msec
<a id="__codelineno-42-40" name="__codelineno-42-40"></a>;; SERVER: 8.8.8.8#53(8.8.8.8)
<a id="__codelineno-42-41" name="__codelineno-42-41"></a>;; WHEN: Fri Feb 17 07:30:56 CET 2023
<a id="__codelineno-42-42" name="__codelineno-42-42"></a>;; MSG SIZE  rcvd: 63
<a id="__codelineno-42-43" name="__codelineno-42-43"></a>
<a id="__codelineno-42-44" name="__codelineno-42-44"></a>
<a id="__codelineno-42-45" name="__codelineno-42-45"></a>## Para el alias 'mail'
<a id="__codelineno-42-46" name="__codelineno-42-46"></a>; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; @8.8.8.8 mail.icecrown.es
<a id="__codelineno-42-47" name="__codelineno-42-47"></a>; (1 server found)
<a id="__codelineno-42-48" name="__codelineno-42-48"></a>;; global options: +cmd
<a id="__codelineno-42-49" name="__codelineno-42-49"></a>;; Got answer:
<a id="__codelineno-42-50" name="__codelineno-42-50"></a>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 46107
<a id="__codelineno-42-51" name="__codelineno-42-51"></a>;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1
<a id="__codelineno-42-52" name="__codelineno-42-52"></a>
<a id="__codelineno-42-53" name="__codelineno-42-53"></a>;; OPT PSEUDOSECTION:
<a id="__codelineno-42-54" name="__codelineno-42-54"></a>; EDNS: version: 0, flags:; udp: 512
<a id="__codelineno-42-55" name="__codelineno-42-55"></a>;; QUESTION SECTION:
<a id="__codelineno-42-56" name="__codelineno-42-56"></a>;mail.icecrown.es.      IN  A
<a id="__codelineno-42-57" name="__codelineno-42-57"></a>
<a id="__codelineno-42-58" name="__codelineno-42-58"></a>;; ANSWER SECTION:
<a id="__codelineno-42-59" name="__codelineno-42-59"></a>mail.icecrown.es.   300 IN  CNAME   arthas.icecrown.es.
<a id="__codelineno-42-60" name="__codelineno-42-60"></a>arthas.icecrown.es. 120 IN  A   15.237.168.75
<a id="__codelineno-42-61" name="__codelineno-42-61"></a>
<a id="__codelineno-42-62" name="__codelineno-42-62"></a>;; Query time: 16 msec
<a id="__codelineno-42-63" name="__codelineno-42-63"></a>;; SERVER: 8.8.8.8#53(8.8.8.8)
<a id="__codelineno-42-64" name="__codelineno-42-64"></a>;; WHEN: Fri Feb 17 07:31:29 CET 2023
<a id="__codelineno-42-65" name="__codelineno-42-65"></a>;; MSG SIZE  rcvd: 82
<a id="__codelineno-42-66" name="__codelineno-42-66"></a>
<a id="__codelineno-42-67" name="__codelineno-42-67"></a>
<a id="__codelineno-42-68" name="__codelineno-42-68"></a>## Para el alias 'webmail'
<a id="__codelineno-42-69" name="__codelineno-42-69"></a>; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; @8.8.8.8 webmail.icecrown.es
<a id="__codelineno-42-70" name="__codelineno-42-70"></a>; (1 server found)
<a id="__codelineno-42-71" name="__codelineno-42-71"></a>;; global options: +cmd
<a id="__codelineno-42-72" name="__codelineno-42-72"></a>;; Got answer:
<a id="__codelineno-42-73" name="__codelineno-42-73"></a>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 9490
<a id="__codelineno-42-74" name="__codelineno-42-74"></a>;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1
<a id="__codelineno-42-75" name="__codelineno-42-75"></a>
<a id="__codelineno-42-76" name="__codelineno-42-76"></a>;; OPT PSEUDOSECTION:
<a id="__codelineno-42-77" name="__codelineno-42-77"></a>; EDNS: version: 0, flags:; udp: 512
<a id="__codelineno-42-78" name="__codelineno-42-78"></a>;; QUESTION SECTION:
<a id="__codelineno-42-79" name="__codelineno-42-79"></a>;webmail.icecrown.es.       IN  A
<a id="__codelineno-42-80" name="__codelineno-42-80"></a>
<a id="__codelineno-42-81" name="__codelineno-42-81"></a>;; ANSWER SECTION:
<a id="__codelineno-42-82" name="__codelineno-42-82"></a>webmail.icecrown.es.    300 IN  CNAME   arthas.icecrown.es.
<a id="__codelineno-42-83" name="__codelineno-42-83"></a>arthas.icecrown.es. 120 IN  A   15.237.168.75
<a id="__codelineno-42-84" name="__codelineno-42-84"></a>
<a id="__codelineno-42-85" name="__codelineno-42-85"></a>;; Query time: 36 msec
<a id="__codelineno-42-86" name="__codelineno-42-86"></a>;; SERVER: 8.8.8.8#53(8.8.8.8)
<a id="__codelineno-42-87" name="__codelineno-42-87"></a>;; WHEN: Fri Feb 17 07:31:59 CET 2023
<a id="__codelineno-42-88" name="__codelineno-42-88"></a>;; MSG SIZE  rcvd: 85
</code></pre></div></td></tr></table></div>
</li>
</ol>
<p>Tras confirmar el funcionamiento del dominio tanto internamente (desde Zentyal) como externamente, el módulo de DNS estará correctamente configurado y podremos proseguir con el siguiente módulo.</p>
<h3 id="modulo-de-controlador-de-dominio">Módulo de Controlador de dominio<a class="headerlink" href="#modulo-de-controlador-de-dominio" title="Permanent link">¶</a></h3>
<p>Una vez tenemos el módulo de DNS configurado, es el turno de configurar el <a href="https://doc.zentyal.org/es/directory.html">controlador de dominio</a>. En mi caso concreto, estableceré las configuraciones opcionales:</p>
<ul>
<li>Añadiré una descripción a la configuración y confirmaré que los perfiles móviles están deshabilitados.</li>
<li>Estableceré una quota por defecto de 1GB para los usuarios del dominio (únicamente afectará a sus directorios personales).</li>
<li>Confirmaré que el PAM está deshabilitado, ya que no quiero que ningún usuario del dominio pueda hacer login mediante SSH o FTP.</li>
</ul>
<p>A continuación las acciones a realizar para configurar el módulo:</p>
<ol>
<li>
<p>Modificamos la descripción del servidor desde <code>Domain -&gt; Server description</code>.</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/dc-description.png"><img alt="DC description" src="../assets/zentyal/dc-description.png" title="DC description"/></a></p>
</li>
<li>
<p>Establecemos el valor que tendrá la quota por defecto para los nuevos usuarios del dominio desde <code>Users and Computers -&gt; User Template</code>:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/dc-quotas.png"><img alt="DC quotas" src="../assets/zentyal/dc-quotas.png" title="DC quotas"/></a></p>
</li>
<li>
<p>Revisamos que el PAM está deshabilitado desde <code>Users and Computers -&gt; LDAP Settings</code>:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/dc-pam.png"><img alt="DC pam" src="../assets/zentyal/dc-pam.png" title="DC pam"/></a></p>
</li>
<li>
<p>Habilitamos el módulo:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/modules_dc.png"><img alt="DC enable" src="../assets/zentyal/modules_dc.png" title="DC enable"/></a></p>
</li>
<li>
<p>Una vez que el módulo haya sido guardado y por ende, el controlador de dominio aprovisionado, comprobamos que la estructura de objetos por defecto se creó con éxito. Para ello, vamos a <code>Users and Computers -&gt; Manage</code>:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/dc-default_structure.png"><img alt="DC default structure" src="../assets/zentyal/dc-default_structure.png" title="DC default structure"/></a></p>
</li>
<li>
<p>Finalmente, creamos un nuevo usuario administrador del dominio, en mi caso se llamará <code>zenadmin</code> y deberá ser miembro del grupo de administradores <code>Domain Admins</code>:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/dc-administrator.png"><img alt="DC administrator" src="../assets/zentyal/dc-administrator.png" title="DC administrator"/></a></p>
</li>
</ol>
<h3 id="modulo-de-correo">Módulo de Correo<a class="headerlink" href="#modulo-de-correo" title="Permanent link">¶</a></h3>
<p>Teniendo configurado el módulo de controlador de dominio, ya podremos configurar el módulo de <a href="https://doc.zentyal.org/es/mail.html">correo</a>, ya que por dependencia requiere que el anterior esté habilitado previamente. En mi caso concreto, estableceré las siguientes configuraciones opcionales:</p>
<ul>
<li>El usuario postmaster será <code>postmaster@icecrown.es</code>.</li>
<li>Estableceré 1GB como quota por defecto para los buzones de correo.</li>
<li>El tamaño máximo de un mensaje aceptado será de 25MB.</li>
<li>Los emails eliminados en los buzones será purgados automáticamente pasados 90 días.</li>
<li>Los correos en la carpeta de spam será borrados automáticamente pasados 90 días.</li>
<li>La sincronización de cuentas de correo external mediante Fetchmail se harán cada 5 minutos.</li>
<li>Únicamente se permitirá los protocolos IMAPS y POP3S.</li>
<li>Fetchmail y Sieve estarán deshabilitados, ya que inicialmente no los usaré.</li>
<li>Se habilitará la lista gris, además, se reducirán a 24 horas para el reenvío de los emails y 30 días como periodo de borrado.</li>
</ul>
<p>A continuación las acciones a realizar para configurar el módulo:</p>
<ol>
<li>
<p>Creamos el dominio virtual de correo, que será el mismo que el dominio configurado en el módulo de DNS. Desde el menú lateral izquierdo iremos a <code>Mail -&gt; Virtual Mail Domains</code>:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/mail-new_domain.png"><img alt="Mail new virtual domain" src="../assets/zentyal/mail-new_domain.png" title="Mail new virtual domain"/></a></p>
</li>
<li>
<p>Establecemos las configuraciones restrictivas opcionales mencionadas desde <code>Mail -&gt; General</code>:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/mail-additional_conf.png"><img alt="Mail additional configuration" src="../assets/zentyal/mail-additional_conf.png" title="Mail additional configuration"/></a></p>
</li>
<li>
<p>Deshabilitamos Fetchmail y Sieve:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/mail-services.png"><img alt="Mail services" src="../assets/zentyal/mail-services.png" title="Mail services"/></a></p>
</li>
<li>
<p>También habilitamos la lista gris desde <code>Mail -&gt; Greylist</code>:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/mail-greylist.png"><img alt="Mail greylist" src="../assets/zentyal/mail-greylist.png" title="Mail greylist"/></a></p>
</li>
<li>
<p>Habilitamos el módulo:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/modules_mail.png"><img alt="Mail enable" src="../assets/zentyal/modules_mail.png" title="Mail enable"/></a></p>
</li>
<li>
<p>Creamos el registro de tipo <code>MX</code> en el dominio, que en mi caso, lo haré desde Route53:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/mail-dns_record.png"><img alt="Mail DNS record" src="../assets/zentyal/mail-dns_record.png" title="Mail DNS record"/></a></p>
<p>Adicionalmente, también lo crearé en Zentyal, no obstante, al ser un alias habrá que hacerlo usando la CLI:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a>sudo<span class="w"> </span>samba-tool<span class="w"> </span>dns<span class="w"> </span>add<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span>icecrown.es<span class="w"> </span>icecrown.es<span class="w"> </span>MX<span class="w"> </span><span class="s2">"mail.icecrown.es 10"</span><span class="w"> </span>-U<span class="w"> </span>zenadmin
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Comprobamos el nuevo registro DNS tanto interna como externamente:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1">1</a></span>
<span class="normal"><a href="#__codelineno-44-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a>dig<span class="w"> </span>MX<span class="w"> </span>icecrown.es
<a id="__codelineno-44-2" name="__codelineno-44-2"></a>dig<span class="w"> </span>@8.8.8.8<span class="w"> </span>MX<span class="w"> </span>icecrown.es
</code></pre></div></td></tr></table></div>
<p>En resultado que obtengo:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-45-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-45-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-45-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-45-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-45-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-45-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-45-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-45-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-45-10">10</a></span>
<span class="normal"><a href="#__codelineno-45-11">11</a></span>
<span class="normal"><a href="#__codelineno-45-12">12</a></span>
<span class="normal"><a href="#__codelineno-45-13">13</a></span>
<span class="normal"><a href="#__codelineno-45-14">14</a></span>
<span class="normal"><a href="#__codelineno-45-15">15</a></span>
<span class="normal"><a href="#__codelineno-45-16">16</a></span>
<span class="normal"><a href="#__codelineno-45-17">17</a></span>
<span class="normal"><a href="#__codelineno-45-18">18</a></span>
<span class="normal"><a href="#__codelineno-45-19">19</a></span>
<span class="normal"><a href="#__codelineno-45-20">20</a></span>
<span class="normal"><a href="#__codelineno-45-21">21</a></span>
<span class="normal"><a href="#__codelineno-45-22">22</a></span>
<span class="normal"><a href="#__codelineno-45-23">23</a></span>
<span class="normal"><a href="#__codelineno-45-24">24</a></span>
<span class="normal"><a href="#__codelineno-45-25">25</a></span>
<span class="normal"><a href="#__codelineno-45-26">26</a></span>
<span class="normal"><a href="#__codelineno-45-27">27</a></span>
<span class="normal"><a href="#__codelineno-45-28">28</a></span>
<span class="normal"><a href="#__codelineno-45-29">29</a></span>
<span class="normal"><a href="#__codelineno-45-30">30</a></span>
<span class="normal"><a href="#__codelineno-45-31">31</a></span>
<span class="normal"><a href="#__codelineno-45-32">32</a></span>
<span class="normal"><a href="#__codelineno-45-33">33</a></span>
<span class="normal"><a href="#__codelineno-45-34">34</a></span>
<span class="normal"><a href="#__codelineno-45-35">35</a></span>
<span class="normal"><a href="#__codelineno-45-36">36</a></span>
<span class="normal"><a href="#__codelineno-45-37">37</a></span>
<span class="normal"><a href="#__codelineno-45-38">38</a></span>
<span class="normal"><a href="#__codelineno-45-39">39</a></span>
<span class="normal"><a href="#__codelineno-45-40">40</a></span>
<span class="normal"><a href="#__codelineno-45-41">41</a></span>
<span class="normal"><a href="#__codelineno-45-42">42</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a>## Consulta interna
<a id="__codelineno-45-2" name="__codelineno-45-2"></a>; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; MX icecrown.es
<a id="__codelineno-45-3" name="__codelineno-45-3"></a>;; global options: +cmd
<a id="__codelineno-45-4" name="__codelineno-45-4"></a>;; Got answer:
<a id="__codelineno-45-5" name="__codelineno-45-5"></a>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 432
<a id="__codelineno-45-6" name="__codelineno-45-6"></a>;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1
<a id="__codelineno-45-7" name="__codelineno-45-7"></a>
<a id="__codelineno-45-8" name="__codelineno-45-8"></a>;; OPT PSEUDOSECTION:
<a id="__codelineno-45-9" name="__codelineno-45-9"></a>; EDNS: version: 0, flags:; udp: 4096
<a id="__codelineno-45-10" name="__codelineno-45-10"></a>; COOKIE: 7d99083c5d639dad0100000063ef22121ec656087bc76972 (good)
<a id="__codelineno-45-11" name="__codelineno-45-11"></a>;; QUESTION SECTION:
<a id="__codelineno-45-12" name="__codelineno-45-12"></a>;icecrown.es.           IN  MX
<a id="__codelineno-45-13" name="__codelineno-45-13"></a>
<a id="__codelineno-45-14" name="__codelineno-45-14"></a>;; ANSWER SECTION:
<a id="__codelineno-45-15" name="__codelineno-45-15"></a>icecrown.es.        900 IN  MX  10 mail.icecrown.es.
<a id="__codelineno-45-16" name="__codelineno-45-16"></a>
<a id="__codelineno-45-17" name="__codelineno-45-17"></a>;; Query time: 8 msec
<a id="__codelineno-45-18" name="__codelineno-45-18"></a>;; SERVER: 127.0.0.1#53(127.0.0.1)
<a id="__codelineno-45-19" name="__codelineno-45-19"></a>;; WHEN: Fri Feb 17 07:43:30 CET 2023
<a id="__codelineno-45-20" name="__codelineno-45-20"></a>;; MSG SIZE  rcvd: 89
<a id="__codelineno-45-21" name="__codelineno-45-21"></a>
<a id="__codelineno-45-22" name="__codelineno-45-22"></a>
<a id="__codelineno-45-23" name="__codelineno-45-23"></a>## Consulta externa
<a id="__codelineno-45-24" name="__codelineno-45-24"></a>; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; @8.8.8.8 MX icecrown.es
<a id="__codelineno-45-25" name="__codelineno-45-25"></a>; (1 server found)
<a id="__codelineno-45-26" name="__codelineno-45-26"></a>;; global options: +cmd
<a id="__codelineno-45-27" name="__codelineno-45-27"></a>;; Got answer:
<a id="__codelineno-45-28" name="__codelineno-45-28"></a>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 28263
<a id="__codelineno-45-29" name="__codelineno-45-29"></a>;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1
<a id="__codelineno-45-30" name="__codelineno-45-30"></a>
<a id="__codelineno-45-31" name="__codelineno-45-31"></a>;; OPT PSEUDOSECTION:
<a id="__codelineno-45-32" name="__codelineno-45-32"></a>; EDNS: version: 0, flags:; udp: 512
<a id="__codelineno-45-33" name="__codelineno-45-33"></a>;; QUESTION SECTION:
<a id="__codelineno-45-34" name="__codelineno-45-34"></a>;icecrown.es.           IN  MX
<a id="__codelineno-45-35" name="__codelineno-45-35"></a>
<a id="__codelineno-45-36" name="__codelineno-45-36"></a>;; ANSWER SECTION:
<a id="__codelineno-45-37" name="__codelineno-45-37"></a>icecrown.es.        300 IN  MX  10 mail.icecrown.es.
<a id="__codelineno-45-38" name="__codelineno-45-38"></a>
<a id="__codelineno-45-39" name="__codelineno-45-39"></a>;; Query time: 36 msec
<a id="__codelineno-45-40" name="__codelineno-45-40"></a>;; SERVER: 8.8.8.8#53(8.8.8.8)
<a id="__codelineno-45-41" name="__codelineno-45-41"></a>;; WHEN: Fri Feb 17 07:44:00 CET 2023
<a id="__codelineno-45-42" name="__codelineno-45-42"></a>;; MSG SIZE  rcvd: 61
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Creamos el usuario <code>postmaster@icecrown.es</code> especificado en el paso 2 y también un usuario de pruebas, que en mi caso se llamará <code>test.djoven</code> . Para ello, iremos a <code>Users and Computers -&gt; Manage</code>:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/mail-user_postmaster.png"><img alt="Mail postmaster user" src="../assets/zentyal/mail-user_postmaster.png" title="Mail postmaster user"/></a>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/mail-test_account.png"><img alt="Mail test account" src="../assets/zentyal/mail-test_account.png" title="Mail test account"/></a></p>
</li>
</ol>
<p>Finalmente, probaremos con un cliente de correo (Thunderbird en mi caso) a que podemos configurar la cuenta del usuario de pruebas creado:</p>
<ol>
<li>
<p>Configuramos una nueva cuenta en Thunderbird:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/mail-thunderbird_new-account.png"><img alt="Thunderbird setup new account" src="../assets/zentyal/mail-thunderbird_new-account.png" title="Thunderbird setup new account"/></a></p>
</li>
<li>
<p>Establecemos los datos de conexión con el servicio SMTPS e IMAPS:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/mail-thunderbird_server.png"><img alt="Thunderbird setup server" src="../assets/zentyal/mail-thunderbird_server.png" title="Thunderbird setup server"/></a></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Hay que cambiar el tipo de autenticación a '<strong>Normal password</strong>', de lo contrario fallará la autenticación.</p>
</div>
</li>
<li>
<p>Tras confirmar la configuración, nos saldrá el siguiente mensaje de advertencia por el certificado, el cual es normal, ya que es un certificado auto-firmado por Zentyal:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/mail-thunderbird_certificate_warning.png"><img alt="Thunderbird setup certificate warning" src="../assets/zentyal/mail-thunderbird_certificate_warning.png" title="Thunderbird setup certificate warning"/></a></p>
</li>
<li>
<p>Una vez confirmada la excepción de seguridad, deberíamos de poder ver la cuenta de correo:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/mail-thunderbird_login.png"><img alt="Thunderbird login" src="../assets/zentyal/mail-thunderbird_login.png" title="Thunderbird login"/></a></p>
</li>
<li>
<p>Enviamos un email de prueba a nosotros mismos y otro a una cuenta externa para confirmar el funcionamiento del módulo.</p>
<div class="admonition nota">
<p class="admonition-title">Nota</p>
<p>Cuando tratemos de enviar el mensaje, volveremos a recibir un error debido a que el certificado es auto-firmado, por lo que tendremos que hacerlo también.</p>
</div>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/mail-thunderbird_sending-error-1.png"><img alt="Thunderbird sending error" src="../assets/zentyal/mail-thunderbird_sending-error-1.png" title="Thunderbird sending error"/></a></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/mail-thunderbird_sending-error-2.png"><img alt="Thunderbird accepting certificate" src="../assets/zentyal/mail-thunderbird_sending-error-2.png" title="Thunderbird accepting certificate"/></a></p>
</li>
<li>
<p>Si todo fue bien, deberíamos de haber recibido el email tanto en la cuenta interna como externa y además, en el log <code>/var/log/mail.log</code> deberíamos de ver registros similares a:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-46-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-46-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-46-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-46-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-46-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-46-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-46-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-46-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-46-10">10</a></span>
<span class="normal"><a href="#__codelineno-46-11">11</a></span>
<span class="normal"><a href="#__codelineno-46-12">12</a></span>
<span class="normal"><a href="#__codelineno-46-13">13</a></span>
<span class="normal"><a href="#__codelineno-46-14">14</a></span>
<span class="normal"><a href="#__codelineno-46-15">15</a></span>
<span class="normal"><a href="#__codelineno-46-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a>Feb 17 07:02:41 ip-10-0-1-200 postfix/smtpd[27139]: connect from 36.red-45-4-127.staticip.rima-tde.net[88.6.127.36]
<a id="__codelineno-46-2" name="__codelineno-46-2"></a>Feb 17 07:02:41 ip-10-0-1-200 postfix/smtpd[27139]: 958BDFEEFC: client=36.red-45-4-127.staticip.rima-tde.net[88.6.127.36], sasl_method=PLAIN, sasl_username=test.
<a id="__codelineno-46-3" name="__codelineno-46-3"></a>djoven@icecrown.es
<a id="__codelineno-46-4" name="__codelineno-46-4"></a>Feb 17 07:02:41 ip-10-0-1-200 postfix/cleanup[27145]: 958BDFEEFC: message-id=&lt;17715909-c13a-eed6-7f23-18f697740075@icecrown.es&gt;
<a id="__codelineno-46-5" name="__codelineno-46-5"></a>Feb 17 07:02:41 ip-10-0-1-200 postfix/qmgr[24894]: 958BDFEEFC: from=&lt;test.djoven@icecrown.es&gt;, size=681, nrcpt=2 (queue active)
<a id="__codelineno-46-6" name="__codelineno-46-6"></a>Feb 17 07:02:41 ip-10-0-1-200 dovecot: lda(test.djoven@icecrown.es)&lt;27148&gt;&lt;b1LEMJEm72MMagAAcf9/Kw&gt;: msgid=&lt;17715909-c13a-eed6-7f23-18f697740075@icecrown.es&gt;: sav
<a id="__codelineno-46-7" name="__codelineno-46-7"></a>ed mail to INBOX
<a id="__codelineno-46-8" name="__codelineno-46-8"></a>
<a id="__codelineno-46-9" name="__codelineno-46-9"></a>Feb 17 07:02:41 ip-10-0-1-200 postfix/pipe[27146]: 958BDFEEFC: to=&lt;test.djoven@icecrown.es&gt;, relay=dovecot, delay=0.29, delays=0.24/0.01/0/0.03, dsn=2.0.0, status=sent (delivered via dovecot service)
<a id="__codelineno-46-10" name="__codelineno-46-10"></a>
<a id="__codelineno-46-11" name="__codelineno-46-11"></a>Feb 17 07:02:41 ip-10-0-1-200 postfix/smtpd[27139]: disconnect from 36.red-45-4-127.staticip.rima-tde.net[88.6.127.36] ehlo=2 starttls=1 auth=1 mail=1 rcpt=2 data=1 quit=1 commands=9
<a id="__codelineno-46-12" name="__codelineno-46-12"></a>Feb 17 07:02:42 ip-10-0-1-200 dovecot: imap-login: Disconnected (no auth attempts in 1 secs): user=&lt;&gt;, rip=88.6.127.36, lip=10.0.1.200, TLS handshaking: SSL_accept() failed: error:14094412:SSL routines:ssl3_read_bytes:sslv3 alert bad certificate: SSL alert number 42, session=&lt;mXZJ5t/0eLxYBn8k&gt;
<a id="__codelineno-46-13" name="__codelineno-46-13"></a>
<a id="__codelineno-46-14" name="__codelineno-46-14"></a>Feb 17 07:02:42 ip-10-0-1-200 postfix/smtp[27147]: 958BDFEEFC: to=&lt;external-account&gt;, relay=gmail-smtp-in.l.google.com[74.125.133.27]:25, delay=1, delays=0.24/0.01/0.08/0.67, dsn=2.0.0, status=sent (250 2.0.0 OK  1676617362 n13-20020adfe34d000000b002c56af91a8esi3912146wrj.115 - gsmtp)
<a id="__codelineno-46-15" name="__codelineno-46-15"></a>
<a id="__codelineno-46-16" name="__codelineno-46-16"></a>Feb 17 07:02:42 ip-10-0-1-200 postfix/qmgr[24894]: 958BDFEEFC: removed
</code></pre></div></td></tr></table></div>
<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Como se puede ver, el status de ambos emails es <code>sent</code>.</p>
</div>
</li>
</ol>
<p>Llegados a este punto, el módulo de correo debería ser totalmente funcional, no obstante, todavía está sin securizar, por lo que es conveniente no usarlo todavía hasta al menos, haber configurado y habilitado el módulo de Mailfilter. Adicionalmente, hay otro apartado en este proyecto llamado <a href="https://zentyal-aws.projects.djoven.es/zentyal-hardening/#modulo-de-correo">Hardening</a> donde se incrementará todavía más la seguridad del módulo.</p>
<p>Mencionar también que si el servidor está instalado en el proveedor cloud AWS, por defecto no se permite enviar emails (revisar la penúltima sección de la página <a href="https://zentyal-aws.projects.djoven.es/aws-configuration/#solicitar-envio-de-correos">AWS</a>).</p>
<h3 id="modulo-de-webmail">Módulo de Webmail<a class="headerlink" href="#modulo-de-webmail" title="Permanent link">¶</a></h3>
<p>El siguiente módulo a configurar será el <a href="https://doc.zentyal.org/es/mail.html#cliente-de-webmail">Webmail</a> (Sogo), el cual nos permitirá gestionar nuestra cuenta de correo desde un navegador web . Además, desde el webmail un usuario podrá cambiar su contraseña.</p>
<ol>
<li>
<p>Habilitamos el protocolo <a href="https://doc.zentyal.org/es/mail.html#soporte-activesync">ActiveSync</a> desde <code>Mail -&gt; ActiveSync</code> por si los usuarios quieren sincronizar sus dispositivos móviles:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/webmail-activesync.png"><img alt="Webmail ActiveSync" src="../assets/zentyal/webmail-activesync.png" title="Webmail ActiveSync"/></a></p>
</li>
<li>
<p>Habilitamos el módulo:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/modules_webmail.png"><img alt="Webmail enable" src="../assets/zentyal/modules_webmail.png" title="Webmail enable"/></a></p>
</li>
<li>
<p>Comprobamos que podemos acceder a la página de login desde un navegador web con la URL: <a href="https://arthas.icecrown.es/SOGo">https://arthas.icecrown.es/SOGo</a>:</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Nos mostrará un mensaje de advertencia por el certificado que usa el servicio, lo cual es normal ya que es auto-firmado.</p>
</div>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/webmail-access_unsafe.png"><img alt="Webmail unsafe message" src="../assets/zentyal/webmail-access_unsafe.png" title="Webmail unsafe message"/></a></p>
</li>
<li>
<p>Una vez aceptada la excepción, deberemos poder visualizar la página de login:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/webmail-access_login.png"><img alt="Webmail login webpage" src="../assets/zentyal/webmail-access_login.png" title="Webmail login webpage"/></a></p>
</li>
<li>
<p>Nos logeamos con el usuario de prueba para confirmar que la autenticación funciona correctamente y que podemos ver nuestro buzón:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/webmail-access_user.png"><img alt="Webmail user login" src="../assets/zentyal/webmail-access_user.png" title="Webmail user login"/></a></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Si no vemos el buzón de correo, es posible que estemos experimentando un bug existente, el cual se produce cuando no se tiene configurado los protocolos no seguros de correo y el certificado usado es auto-firmado. Para solucionarlo, ver la página <a href="https://zentyal-aws.projects.djoven.es/zentyal-bug-fixing/#imaps">bug fixing</a>.</p>
</div>
</li>
<li>
<p>Finalmente, tratamos de enviar otro email a nosotros mismos para verificar la integración con el módulo de correo:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/webmail-sending_email.png"><img alt="Webmail sending an email" src="../assets/zentyal/webmail-sending_email.png" title="Webmail sending an email"/></a></p>
</li>
</ol>
<p>Llegados a este punto, el módulo es totalmente funcional, no obstante, estableceré las siguientes configuraciones opcionales:</p>
<ul>
<li>Habilitaré la opción de mensajes automáticos para las vacaciones, ya que por defecto está deshabilitada.</li>
<li>Estableceré inicialmente a 8 el número de workers (procesos) que usará el módulo.</li>
</ul>
<p>A continuación las acciones a realizar para aplicar las configuraciones opcionales:</p>
<ol>
<li>
<p>Creamos el directorio que hará de los cambios sobre las plantillas de configuración (stubs) sean persistentes ante actualizaciones del módulo:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>-vp<span class="w"> </span>/etc/zentyal/stubs/sogo
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Copiamos la plantilla de configuración de Sogo <code>sogo.conf.mas</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a>sudo<span class="w"> </span>cp<span class="w"> </span>-v<span class="w"> </span>/usr/share/zentyal/stubs/sogo/sogo.conf.mas<span class="w"> </span>/etc/zentyal/stubs/sogo/
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Establecemos el parámetro <code>SOGoVacationEnabled</code> a <code>YES</code> en la plantilla recién copiada:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a>sudo<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">'s/SOGoVacationEnabled.*/SOGoVacationEnabled = YES;/'</span><span class="w"> </span>/etc/zentyal/stubs/sogo/sogo.conf.mas
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Reiniciamos el módulo de Webmail para aplicar el cambio:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a>sudo<span class="w"> </span>zs<span class="w"> </span>sogo<span class="w"> </span>restart
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Nos logeamos en el Webadmin nuevamente y verificamos que desde <code>Preferences -&gt; Mail</code> ya tenemos la opción disponible:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/webmail-vacactions.png"><img alt="Webmail vacations" src="../assets/zentyal/webmail-vacactions.png" title="Webmail vacations"/></a></p>
</li>
<li>
<p>Establecemos el valor del prefork en el archivo de configuración <code>/etc/zentyal/sogo.conf</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-51-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">'s/#sogod_prefork.*/sogod_prefork=8/'</span><span class="w"> </span>/etc/zentyal/sogo.conf
</code></pre></div></td></tr></table></div>
<p>Si tenemos muchos usuarios concurrentes usando el módulo, es posible que Sogo no pueda gestionar bien todas las peticiones, por lo que será necesario incrementar este valor. Para detectar esta casuística, simplemente habrá que buscar registros en el log de Sogo ubicado en <code>/var/log/sogo/sogo.log</code> similares a la siguiente:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a>sogod<span class="w"> </span><span class="o">[</span><span class="m">3252</span><span class="o">]</span>:<span class="w"> </span><span class="o">[</span>ERROR<span class="o">]</span><span class="w"> </span>&lt;0x0x55c9db827250<span class="o">[</span>WOWatchDog<span class="o">]</span>&gt;<span class="w"> </span>No<span class="w"> </span>child<span class="w"> </span>available<span class="w"> </span>to<span class="w"> </span>handle<span class="w"> </span>incoming<span class="w"> </span>request!
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Reiniciamos el módulo de Webmail para aplicar el cambio:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a>sudo<span class="w"> </span>zs<span class="w"> </span>sogo<span class="w"> </span>restart
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Finalmente, comprobamos que el servicio se levanto con el nuevo valor aplicado:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a>ps<span class="w"> </span>-ef<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>sogod<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1
</code></pre></div></td></tr></table></div>
<p>En mi caso, el resultado obtenido del comando ha sido:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a>sogo<span class="w"> </span><span class="m">24430</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">00</span>:40<span class="w"> </span>?<span class="w"> </span><span class="m">00</span>:00:00<span class="w"> </span>/usr/sbin/sogod<span class="w"> </span>-WOWorkersCount<span class="w"> </span><span class="m">8</span><span class="w"> </span>-WOPidFile<span class="w"> </span>/var/run/sogo/sogo.pid<span class="w"> </span>-WOLogFile<span class="w"> </span>/var/log/sogo/sogo.log
</code></pre></div></td></tr></table></div>
</li>
</ol>
<h3 id="modulo-de-antivirus">Módulo de Antivirus<a class="headerlink" href="#modulo-de-antivirus" title="Permanent link">¶</a></h3>
<p>El siguiente módulo que configuraremos será el <a href="https://doc.zentyal.org/es/antivirus.html">Antivirus</a>. Si bien es cierto que este módulo consume mucha RAM, es necesario para el análisis de los emails que gestiona el módulo de mailfilter.</p>
<p>La configuración que podemos definir a este módulo desde el panel de administración de Zentyal en la versión Development es inexistente, por lo que sólo podremos habilitar el módulo y comprobar que la base de datos de firma está actualizada.</p>
<ol>
<li>
<p>Habilitamos el módulo:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/modules_antivirus.png"><img alt="Antivirus enable" src="../assets/zentyal/modules_antivirus.png" title="Antivirus enable"/></a></p>
</li>
<li>
<p>Actualizamos la base de datos de firmas:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a>sudo<span class="w"> </span>freshclam<span class="w"> </span>-v
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Confirmamos que el módulo esté activo:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a>sudo<span class="w"> </span>zs<span class="w"> </span>antivirus<span class="w"> </span>status
</code></pre></div></td></tr></table></div>
</li>
</ol>
<p>En caso de usar una versión comercial, tendremos las siguientes funcionalidades adicionales descritas <a href="https://doc.zentyal.org/es/antivirus.html#configuracion-del-modulo-antivirus">aquí</a>:</p>
<ul>
<li>Análisis del sistema.</li>
<li>Monitorización en directo de directorios.</li>
</ul>
<h3 id="modulo-de-mailfilter">Módulo de Mailfilter<a class="headerlink" href="#modulo-de-mailfilter" title="Permanent link">¶</a></h3>
<p>Tras habilitar el Antivirus, procederemos a configurar el módulo de <a href="https://doc.zentyal.org/es/mailfilter.html">Mailfilter</a>, el cual nos va a permitir incrementar considerablemente la seguridad sobre el servicio de correo de la organización.</p>
<p>La configuración que aplicaré será:</p>
<ul>
<li>Usaré la cuenta de correo <code>issues@icecrown.es</code> para las notificaciones de correos problemáticos.</li>
<li>Estableceré en 5 el umbral de emails considerados SPAM.</li>
<li>También estableceré a 5 el umbral de auto-learn.</li>
<li>El dominio lo añadiré a la lista gris.</li>
<li>Salvo la política de cabeceras incorrectas, el resto serán denegadas.</li>
<li>Deshabilitaré ciertas extensiones que pueden suponer un riesgo de seguridad.</li>
</ul>
<p>A continuación las acciones a realizar para configurar el módulo:</p>
<ol>
<li>
<p>Habilitamos los servicios de este módulo y estableceremos un correo electrónico para emails problemáticos que no sean spam desde <code>Mail filter -&gt; SMTP Mail Filter</code>:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/mailfilter-general.png"><img alt="Mailfilter services" src="../assets/zentyal/mailfilter-general.png" title="Mailfilter services"/></a></p>
</li>
<li>
<p>Establecemos las políticas por defecto relativas al comportamiento del módulo ante ciertos eventos:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/mailfilter-filter_policies.png"><img alt="Mailfilter event policies" src="../assets/zentyal/mailfilter-filter_policies.png" title="Mailfilter event policies"/></a></p>
</li>
<li>
<p>Establecemos las políticas antispam desde <code>Mail Filter -&gt; Antispam</code>:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/mailfilter-antispam_configuration.png"><img alt="Mailfilter Antispam configuration" src="../assets/zentyal/mailfilter-antispam_configuration.png" title="Mailfilter Antispam configuration"/></a></p>
</li>
<li>
<p>Opcionalmente, podemos añadir nuestro dominio a la lista blanca para que no sea procesado por el módulo de Mailfilter:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/mailfilter-antispam_senders.png"><img alt="Mailfilter whitelist" src="../assets/zentyal/mailfilter-antispam_senders.png" title="Mailfilter whitelist"/></a></p>
</li>
<li>
<p>Deshabilitamos las siguientes extensiones desde <code>Mail Filter -&gt; Files ACL -&gt; File extensions</code>:</p>
<ul>
<li>bas</li>
<li>bat</li>
<li>cmd</li>
<li>dll</li>
<li>exe</li>
<li>ini</li>
<li>msi</li>
<li>reg</li>
<li>sh</li>
</ul>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/mailfilter-files_extensions.png"><img alt="Mailfilter file extensions" src="../assets/zentyal/mailfilter-files_extensions.png" title="Mailfilter file extensions"/></a></p>
</li>
<li>
<p>Habilitamos el módulo:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/modules_mailfilter.png"><img alt="Mailfilter enable" src="../assets/zentyal/modules_mailfilter.png" title="Mailfilter enable"/></a></p>
</li>
<li>
<p>Creamos la cuenta de correo que hemos establecido en el paso 1 desde <code>Users and Computers -&gt; Manage</code>:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/mailfilter-issues_account.png"><img alt="Mail account for issues" src="../assets/zentyal/mailfilter-issues_account.png" title="Mail account for issues"/></a></p>
</li>
<li>
<p>Nos enviamos un email sencillo desde un dominio externo y revisamos en el archivo de log <code>/var/log/mail.log</code> que el módulo lo haya analizado a través del servicio Amavis:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-58-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-58-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-58-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-58-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-58-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-58-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-58-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-58-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-58-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-58-10">10</a></span>
<span class="normal"><a href="#__codelineno-58-11">11</a></span>
<span class="normal"><a href="#__codelineno-58-12">12</a></span>
<span class="normal"><a href="#__codelineno-58-13">13</a></span>
<span class="normal"><a href="#__codelineno-58-14">14</a></span>
<span class="normal"><a href="#__codelineno-58-15">15</a></span>
<span class="normal"><a href="#__codelineno-58-16">16</a></span>
<span class="normal"><a href="#__codelineno-58-17">17</a></span>
<span class="normal"><a href="#__codelineno-58-18">18</a></span>
<span class="normal"><a href="#__codelineno-58-19">19</a></span>
<span class="normal"><a href="#__codelineno-58-20">20</a></span>
<span class="normal"><a href="#__codelineno-58-21">21</a></span>
<span class="normal"><a href="#__codelineno-58-22">22</a></span>
<span class="normal"><a href="#__codelineno-58-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1"></a>Feb 18 11:18:57 arthas postfix/smtpd[18582]: connect from mail-lj1-f176.google.com[209.85.208.176]
<a id="__codelineno-58-2" name="__codelineno-58-2"></a>Feb 18 11:18:57 arthas postgrey[16618]: action=pass, reason=client whitelist, client_name=mail-lj1-f176.google.com, client_address=209.85.208.176/32, sender=some-account@gmail.com, recipient=test.djoven@icecrown.es
<a id="__codelineno-58-3" name="__codelineno-58-3"></a>Feb 18 11:18:57 arthas postfix/smtpd[18582]: A69DDFEF59: client=mail-lj1-f176.google.com[209.85.208.176]
<a id="__codelineno-58-4" name="__codelineno-58-4"></a>Feb 18 11:18:57 arthas postfix/cleanup[18587]: A69DDFEF59: message-id=&lt;CAHOKk5tCux0aM8WgNr_RQJ7YXBr1H6Er37AT5j9vvyJ1ZORSKw@mail.gmail.com&gt;
<a id="__codelineno-58-5" name="__codelineno-58-5"></a>Feb 18 11:18:57 arthas postfix/qmgr[18435]: A69DDFEF59: from=&lt;some-account@gmail.com&gt;, size=2749, nrcpt=1 (queue active)
<a id="__codelineno-58-6" name="__codelineno-58-6"></a>Feb 18 11:18:57 arthas amavis[18438]: (18438-01) ESMTP :10024 /var/lib/amavis/amavis-20230218T111857-18438-QzIlgFHk: &lt;some-account@gmail.com&gt; -&gt; &lt;test.djoven@icecrown.es&gt; SIZE=2749 Received: from mail.icecrown.es ([127.0.0.1]) by localhost (arthas.icecrown.es [127.0.0.1]) (amavisd-new, port 10024) with ESMTP for &lt;test.djoven@icecrown.es&gt;; Sat, 18 Feb 2023 11:18:57 +0100 (CET)
<a id="__codelineno-58-7" name="__codelineno-58-7"></a>Feb 18 11:18:57 arthas amavis[18438]: (18438-01) Checking: O_3VfGJTdv4Z [127.0.0.1] &lt;some-account@gmail.com&gt; -&gt; &lt;test.djoven@icecrown.es&gt;
<a id="__codelineno-58-8" name="__codelineno-58-8"></a>Feb 18 11:18:59 arthas amavis[18591]: (18438-01) SA info: util: setuid: ruid=128 euid=128 rgid=136 136 egid=136 136
<a id="__codelineno-58-9" name="__codelineno-58-9"></a>Feb 18 11:19:02 arthas postfix/smtpd[18592]: connect from localhost.localdomain[127.0.0.1]
<a id="__codelineno-58-10" name="__codelineno-58-10"></a>Feb 18 11:19:02 arthas postfix/smtpd[18592]: 8975FFEF70: client=localhost.localdomain[127.0.0.1]
<a id="__codelineno-58-11" name="__codelineno-58-11"></a>Feb 18 11:19:02 arthas postfix/cleanup[18587]: 8975FFEF70: message-id=&lt;CAHOKk5tCux0aM8WgNr_RQJ7YXBr1H6Er37AT5j9vvyJ1ZORSKw@mail.gmail.com&gt;
<a id="__codelineno-58-12" name="__codelineno-58-12"></a>Feb 18 11:19:02 arthas postfix/qmgr[18435]: 8975FFEF70: from=&lt;some-account@gmail.com&gt;, size=3762, nrcpt=1 (queue active)
<a id="__codelineno-58-13" name="__codelineno-58-13"></a>
<a id="__codelineno-58-14" name="__codelineno-58-14"></a>Feb 18 11:19:02 arthas amavis[18438]: (18438-01) O_3VfGJTdv4Z FWD from &lt;some-account@gmail.com&gt; -&gt; &lt;test.djoven@icecrown.es&gt;, BODY=7BIT 250 2.0.0 from MTA(smtp:[127.0.0.1]:10025): 250 2.0.0 Ok: queued as 8975FFEF70
<a id="__codelineno-58-15" name="__codelineno-58-15"></a><span class="hll">Feb 18 11:19:02 arthas amavis[18438]: (18438-01) Passed CLEAN, [127.0.0.1] &lt;some-account@gmail.com&gt; -&gt; &lt;test.djoven@icecrown.es&gt;, Message-ID: &lt;CAHOKk5tCux0aM8WgNr_RQJ7YXBr1H6Er37AT5j9vvyJ1ZORSKw@mail.gmail.com&gt;, Hits: -5.947
</span><a id="__codelineno-58-16" name="__codelineno-58-16"></a>Feb 18 11:19:02 arthas postfix/smtp[18588]: A69DDFEF59: to=&lt;test.djoven@icecrown.es&gt;, relay=127.0.0.1[127.0.0.1]:10024, delay=4.9, delays=0.07/0.01/0.01/4.9, dsn=2.0.0, status=sent (250 2.0.0 from MTA(smtp:[127.0.0.1]:10025): 250 2.0.0 Ok: queued as 8975FFEF70)
<a id="__codelineno-58-17" name="__codelineno-58-17"></a>
<a id="__codelineno-58-18" name="__codelineno-58-18"></a>Feb 18 11:19:02 arthas postfix/qmgr[18435]: A69DDFEF59: removed
<a id="__codelineno-58-19" name="__codelineno-58-19"></a>
<a id="__codelineno-58-20" name="__codelineno-58-20"></a>Feb 18 11:19:02 arthas dovecot: lda(test.djoven@icecrown.es)&lt;18594&gt;&lt;u/B4JBam8GOiSAAAcf9/Kw&gt;: msgid=&lt;CAHOKk5tCux0aM8WgNr_RQJ7YXBr1H6Er37AT5j9vvyJ1ZORSKw@mail.gmail.com&gt;: saved mail to INBOX
<a id="__codelineno-58-21" name="__codelineno-58-21"></a>Feb 18 11:19:02 arthas postfix/pipe[18593]: 8975FFEF70: to=&lt;test.djoven@icecrown.es&gt;, relay=dovecot, delay=0.09, delays=0.03/0.01/0/0.05, dsn=2.0.0, status=sent (delivered via dovecot service)
<a id="__codelineno-58-22" name="__codelineno-58-22"></a>
<a id="__codelineno-58-23" name="__codelineno-58-23"></a>Feb 18 11:19:02 arthas postfix/qmgr[18435]: 8975FFEF70: removed
</code></pre></div></td></tr></table></div>
<p>Como se puede ver, el mensaje llegó desde una cuenta de GMail, fue analizado por el servicio 'Amavis', el cual lo puntuó con '-5.947' por lo que lo dío por bueno y el mensaje llegó al buzón de correo del usuario interno.</p>
</li>
<li>
<p>Confirmado que los emails son correctamente recibidos, procederemos a comprobar mediante el envío de otro email con un archivo adjunto cuya extensión sea <code>.sh</code> - denegada en el paso 5 - desde una cuenta externa para confirmar el funcionamiento del módulo. A continuación los registros registrados en el log  <code>/var/log/mail.log</code> relativos al éxito del bloqueo:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-59-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-59-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-59-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-59-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-59-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-59-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-59-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-59-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-59-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-59-10">10</a></span>
<span class="normal"><a href="#__codelineno-59-11">11</a></span>
<span class="normal"><a href="#__codelineno-59-12">12</a></span>
<span class="normal"><a href="#__codelineno-59-13">13</a></span>
<span class="normal"><a href="#__codelineno-59-14">14</a></span>
<span class="normal"><a href="#__codelineno-59-15">15</a></span>
<span class="normal"><a href="#__codelineno-59-16">16</a></span>
<span class="normal"><a href="#__codelineno-59-17">17</a></span>
<span class="normal"><a href="#__codelineno-59-18">18</a></span>
<span class="normal"><a href="#__codelineno-59-19">19</a></span>
<span class="normal"><a href="#__codelineno-59-20">20</a></span>
<span class="normal"><a href="#__codelineno-59-21">21</a></span>
<span class="normal"><a href="#__codelineno-59-22">22</a></span>
<span class="normal"><a href="#__codelineno-59-23">23</a></span>
<span class="normal"><a href="#__codelineno-59-24">24</a></span>
<span class="normal"><a href="#__codelineno-59-25">25</a></span>
<span class="normal"><a href="#__codelineno-59-26">26</a></span>
<span class="normal"><a href="#__codelineno-59-27">27</a></span>
<span class="normal"><a href="#__codelineno-59-28">28</a></span>
<span class="normal"><a href="#__codelineno-59-29">29</a></span>
<span class="normal"><a href="#__codelineno-59-30">30</a></span>
<span class="normal"><a href="#__codelineno-59-31">31</a></span>
<span class="normal"><a href="#__codelineno-59-32">32</a></span>
<span class="normal"><a href="#__codelineno-59-33">33</a></span>
<span class="normal"><a href="#__codelineno-59-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1"></a>Feb 18 11:31:30 arthas postfix/smtpd[18720]: connect from mail-lj1-f171.google.com[209.85.208.171]
<a id="__codelineno-59-2" name="__codelineno-59-2"></a>Feb 18 11:31:30 arthas postgrey[16618]: action=pass, reason=client whitelist, client_name=mail-lj1-f171.google.com, client_address=209.85.208.171/32, sender=some-account@gmail.com, recipient=test.djoven@icecrown.es
<a id="__codelineno-59-3" name="__codelineno-59-3"></a>Feb 18 11:31:30 arthas postfix/smtpd[18720]: 79C12FEF59: client=mail-lj1-f171.google.com[209.85.208.171]
<a id="__codelineno-59-4" name="__codelineno-59-4"></a>Feb 18 11:31:30 arthas postfix/cleanup[18722]: 79C12FEF59: message-id=&lt;CAHOKk5uyuTatJ4c7_qp9oZsovphBziK_YDbUfHtO7Jkg89P5yQ@mail.gmail.com&gt;
<a id="__codelineno-59-5" name="__codelineno-59-5"></a>Feb 18 11:31:30 arthas postfix/qmgr[18435]: 79C12FEF59: from=&lt;some-account@gmail.com&gt;, size=3158, nrcpt=1 (queue active)
<a id="__codelineno-59-6" name="__codelineno-59-6"></a>
<a id="__codelineno-59-7" name="__codelineno-59-7"></a>Feb 18 11:31:30 arthas amavis[18438]: (18438-02) ESMTP :10024 /var/lib/amavis/amavis-20230218T111857-18438-QzIlgFHk: &lt;some-account@gmail.com&gt; -&gt; &lt;test.djoven@icecrown.es&gt; SIZE=3158 Received: from mail.icecrown.es ([127.0.0.1]) by localhost (arthas.icecrown.es [127.0.0.1]) (amavisd-new, port 10024) with ESMTP for &lt;test.djoven@icecrown.es&gt;; Sat, 18 Feb 2023 11:31:30 +0100 (CET)
<a id="__codelineno-59-8" name="__codelineno-59-8"></a>Feb 18 11:31:30 arthas amavis[18438]: (18438-02) Checking: BVbKQQ9S3o7N [127.0.0.1] &lt;some-account@gmail.com&gt; -&gt; &lt;test.djoven@icecrown.es&gt;
<a id="__codelineno-59-9" name="__codelineno-59-9"></a>Feb 18 11:31:30 arthas amavis[18438]: (18438-02) p.path BANNED:1 test.djoven@icecrown.es: "P=p004,L=1,M=multipart/mixed | P=p003,L=1/2,M=application/x-shellscript,T=asc,N=sample-script.sh", matching_key="(?^i:\\.sh$)"
<a id="__codelineno-59-10" name="__codelineno-59-10"></a>
<a id="__codelineno-59-11" name="__codelineno-59-11"></a>Feb 18 11:31:30 arthas postfix/smtpd[18725]: connect from localhost.localdomain[127.0.0.1]
<a id="__codelineno-59-12" name="__codelineno-59-12"></a>Feb 18 11:31:30 arthas postfix/smtpd[18725]: AA4D5FEF71: client=localhost.localdomain[127.0.0.1]
<a id="__codelineno-59-13" name="__codelineno-59-13"></a>Feb 18 11:31:30 arthas postfix/cleanup[18722]: AA4D5FEF71: message-id=&lt;VABVbKQQ9S3o7N@arthas.icecrown.es&gt;
<a id="__codelineno-59-14" name="__codelineno-59-14"></a>Feb 18 11:31:30 arthas postfix/smtpd[18725]: disconnect from localhost.localdomain[127.0.0.1] ehlo=1 mail=1 rcpt=1 data=1 quit=1 commands=5
<a id="__codelineno-59-15" name="__codelineno-59-15"></a>Feb 18 11:31:30 arthas postfix/qmgr[18435]: AA4D5FEF71: from=&lt;postmaster@arthas.icecrown.es&gt;, size=4373, nrcpt=1 (queue active)
<a id="__codelineno-59-16" name="__codelineno-59-16"></a>
<a id="__codelineno-59-17" name="__codelineno-59-17"></a>Feb 18 11:31:30 arthas amavis[18438]: (18438-02) yMQxchA40B3f(BVbKQQ9S3o7N) SEND from &lt;postmaster@arthas.icecrown.es&gt; -&gt; &lt;issues@icecrown.es&gt;, ENVID=AM.yMQxchA40B3f.20230218T103130Z@arthas.icecrown.es 250 2.0.0 from MTA(smtp:[127.0.0.1]:10025): 250 2.0.0 Ok: queued as AA4D5FEF71
<a id="__codelineno-59-18" name="__codelineno-59-18"></a>Feb 18 11:31:30 arthas postfix/smtpd[18725]: connect from localhost.localdomain[127.0.0.1]
<a id="__codelineno-59-19" name="__codelineno-59-19"></a>Feb 18 11:31:30 arthas postfix/smtpd[18725]: B0E32FEF75: client=localhost.localdomain[127.0.0.1]
<a id="__codelineno-59-20" name="__codelineno-59-20"></a>Feb 18 11:31:30 arthas postfix/cleanup[18722]: B0E32FEF75: message-id=&lt;VSBVbKQQ9S3o7N@arthas.icecrown.es&gt;
<a id="__codelineno-59-21" name="__codelineno-59-21"></a>Feb 18 11:31:30 arthas postfix/smtpd[18725]: disconnect from localhost.localdomain[127.0.0.1] ehlo=1 mail=1 rcpt=1 data=1 quit=1 commands=5
<a id="__codelineno-59-22" name="__codelineno-59-22"></a>Feb 18 11:31:30 arthas postfix/qmgr[18435]: B0E32FEF75: from=&lt;&gt;, size=6606, nrcpt=1 (queue active)
<a id="__codelineno-59-23" name="__codelineno-59-23"></a>
<a id="__codelineno-59-24" name="__codelineno-59-24"></a>Feb 18 11:31:30 arthas amavis[18438]: (18438-02) jkDgUKQwzSN1(BVbKQQ9S3o7N) SEND from &lt;&gt; -&gt; &lt;some-account@gmail.com&gt;, BODY=7BIT ENVID=AM.jkDgUKQwzSN1.20230218T103130Z@arthas.icecrown.es 250 2.0.0 from MTA(smtp:[127.0.0.1]:10025): 250 2.0.0 Ok: queued as B0E32FEF75
<a id="__codelineno-59-25" name="__codelineno-59-25"></a><span class="hll">Feb 18 11:31:30 arthas amavis[18438]: (18438-02) Blocked BANNED (application/x-shellscript,.asc,sample-script.sh), [127.0.0.1] &lt;some-account@gmail.com&gt; -&gt; &lt;test.djoven@icecrown.es&gt;, Message-ID: &lt;CAHOKk5uyuTatJ4c7_qp9oZsovphBziK_YDbUfHtO7Jkg89P5yQ@mail.gmail.com&gt;, Hits: -
</span><a id="__codelineno-59-26" name="__codelineno-59-26"></a>Feb 18 11:31:30 arthas postfix/smtp[18723]: 79C12FEF59: to=&lt;test.djoven@icecrown.es&gt;, relay=127.0.0.1[127.0.0.1]:10024, delay=0.29, delays=0.08/0.01/0/0.2, dsn=2.5.0, status=sent (250 2.5.0 Ok, id=18438-02, BOUNCE)
<a id="__codelineno-59-27" name="__codelineno-59-27"></a>Feb 18 11:31:30 arthas postfix/qmgr[18435]: 79C12FEF59: removed
<a id="__codelineno-59-28" name="__codelineno-59-28"></a>
<a id="__codelineno-59-29" name="__codelineno-59-29"></a>Feb 18 11:31:30 arthas dovecot: lda(issues@icecrown.es)&lt;18727&gt;&lt;zrubKwKp8GMnSQAAcf9/Kw&gt;: msgid=&lt;VABVbKQQ9S3o7N@arthas.icecrown.es&gt;: saved mail to INBOX
<a id="__codelineno-59-30" name="__codelineno-59-30"></a><span class="hll">Feb 18 11:31:30 arthas postfix/pipe[18726]: AA4D5FEF71: to=&lt;issues@icecrown.es&gt;, relay=dovecot, delay=0.07, delays=0.02/0.01/0/0.04, dsn=2.0.0, status=sent (delivered via dovecot service)
</span><a id="__codelineno-59-31" name="__codelineno-59-31"></a>Feb 18 11:31:30 arthas postfix/qmgr[18435]: AA4D5FEF71: removed
<a id="__codelineno-59-32" name="__codelineno-59-32"></a>
<a id="__codelineno-59-33" name="__codelineno-59-33"></a>Feb 18 11:31:31 arthas postfix/smtp[18728]: B0E32FEF75: to=&lt;some-account@gmail.com&gt;, relay=gmail-smtp-in.l.google.com[173.194.76.27]:25, delay=0.47, delays=0.02/0.01/0.08/0.36, dsn=2.0.0, status=sent (250 2.0.0 OK  1676716291 o14-20020a5d62ce000000b002c58cc4a950si7000660wrv.22 - gsmtp)
<a id="__codelineno-59-34" name="__codelineno-59-34"></a>Feb 18 11:31:31 arthas postfix/qmgr[18435]: B0E32FEF75: removed
</code></pre></div></td></tr></table></div>
<p>Como se puede apreciar, el email procedente de una cuenta de GMail llegó al servidor, el servicio de Amavis lo analizó y denegó debido a la extensión del archivo adjunto. A continuación se lo notificó a la cuenta <code>issues@icecrown.es</code> y finalmente, devolvió el correo a la cuenta externa.</p>
</li>
<li>
<p>Finalmente, confirmamos que la cuenta <code>issues@icecrown.es</code> tiene un email con nuestra última prueba.</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/mailfilter-confirmed_spam.png"><img alt="Mail confirmation" src="../assets/zentyal/mailfilter-confirmed_spam.png" title="Mail confirmation"/></a></p>
</li>
</ol>
<p>Llegados a este punto, nuestro servicio de correo es lo suficientemente seguro para ser utilizado en producción. No obstante, es altamente recomendable configurar como mínimo SPF y DKIM e idealmente, DMARC. Estas configuraciones relativas a la seguridad se tratan en la página <a href="https://zentyal-aws.projects.djoven.es/zentyal-hardening/#modulo-de-correo">Hardening</a>. Adicionalmente, también es recomendable establecer certificados emitidos por entidades certificadoras reconocidas como Let's Encrypt. Nuevamente, esto será tratado en otra página del proyecto, concretamente en <a href="https://zentyal-aws.projects.djoven.es/zentyal-certificates/">Certificates</a>.</p>
<h3 id="modulo-de-ca">Módulo de CA<a class="headerlink" href="#modulo-de-ca" title="Permanent link">¶</a></h3>
<p>Para poder hacer uso del módulo de OpenVPN, necesitaremos configurar previamente el módulo de <a href="https://doc.zentyal.org/es/ca.html">CA</a>, el cual es extremadamente sencillo de configurar.</p>
<ol>
<li>
<p>Creamos nuestra entidad de certificación desde <code>Certificate Authority -&gt; General</code>:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/ca-creation.png"><img alt="CA creation" src="../assets/zentyal/ca-creation.png" title="CA Creation"/></a></p>
</li>
<li>
<p>Finalmente, guardamos cambios para que se cree nuestra CA.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Este módulo no tiene posibilidad de '<em>habilitarse</em>' como el resto.</p>
</div>
</li>
</ol>
<p>Adicionalmente, es posible emitir certificados para los módulos que estamos usando con el CommonName correctos, no obstante, como vamos a emitir certificados reconocidos a través de Let's Encrypt, no haremos uso de tal funcionalidad. De querer usarse, habría que ir a <code>Certificate Authority -&gt; Services</code> como se indica a continuación:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/ca-services.png"><img alt="Certificates for services" src="../assets/zentyal/ca-services.png" title="Certificates for services"/></a></p>
<h3 id="modulo-de-openvpn">Módulo de OpenVPN<a class="headerlink" href="#modulo-de-openvpn" title="Permanent link">¶</a></h3>
<p>El último módulo que configuraremos será el de <a href="https://doc.zentyal.org/es/vpn.html">OpenVPN</a>. La finalidad de usar este módulo es permitir que los usuarios del dominio puedan hacer uso de los recursos compartidos configurados en el módulo de controlador de dominio de forma segura estando en cualquier ubicación.</p>
<p>Las configuraciones que estableceré serán:</p>
<ul>
<li>Como medida de seguridad adicional, únicamente se permitirá el acceso usando certificados cuyo CommonName tengan el prefijo: <code>Icecrown-RC-</code>.</li>
<li>El certificado usado como prefijo para la conexión VPN, tendrá una validez de 120 días. No obstante, hay que tener en cuenta que definiendo ese valor nos forzará a tener que realizar tareas de mantenimiento cada 4 meses.</li>
<li>Se usará un puerto y dirección VPN distintas al por defecto.</li>
</ul>
<p>A continuación las acciones a realizar para configurar el módulo:</p>
<ol>
<li>
<p>Creamos el certificado cuyo nombre usaremos como. Para ello, vamos a <code>Certificate Authority -&gt; General</code>:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/ca-prefix-certificate.png"><img alt="CA prefix certificate" src="../assets/zentyal/ca-prefix-certificate.png" title="CA prefix certificate"/></a></p>
</li>
<li>
<p>Creamos la conexión VPN desde <code>VPN -&gt; Servers</code>:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/vpn-server.png"><img alt="OpenVPN server" src="../assets/zentyal/vpn-server.png" title="OpenVPN server"/></a></p>
</li>
<li>
<p>Configuramos la conexión desde <code>VPN -&gt; Servers -&gt; Configuration</code>:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/vpn-configuration-1.png"><img alt="OpenVPN configuration 1" src="../assets/zentyal/vpn-configuration-1.png" title="OpenVPN configuration 1"/></a>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/vpn-configuration-2.png"><img alt="OpenVPN configuration 2" src="../assets/zentyal/vpn-configuration-2.png" title="OpenVPN configuration 2"/></a></p>
</li>
<li>
<p>Confirmamos que la red internal de servidor está configurada en la conexión VPN, para ello vamos a <code>VPN -&gt; Servers -&gt; Advertised networks</code>:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/vpn-network-configuration.png"><img alt="OpenVPN network configuration" src="../assets/zentyal/vpn-network-configuration.png" title="OpenVPN network configuration"/></a></p>
</li>
<li>
<p>Habilitamos el módulo:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/modules_openvpn.png"><img alt="OpenVPN enable" src="../assets/zentyal/modules_openvpn.png" title="OpenVPN enable"/></a></p>
</li>
<li>
<p>Creamos un servicio de red con el puerto de la conexión VPN definida:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/vpn-service-1.png"><img alt="OpenVPN network service" src="../assets/zentyal/vpn-service-1.png" title="OpenVPN network service"/></a>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/vpn-service-2.png"><img alt="OpenVPN network service port" src="../assets/zentyal/vpn-service-2.png" title="OpenVPN network service port"/></a></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Recordad que el protocolo es <strong>UDP</strong>.</p>
</div>
</li>
<li>
<p>Finalmente, creamos una regla en el firewall de Zentyal que permita la conexión y guardamos cambios:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/vpn-firewall.png"><img alt="OpenVPN firewall rule" src="../assets/zentyal/vpn-firewall.png" title="OpenVPN firewall rule"/></a></p>
</li>
</ol>
<p>Con el módulo ya configurado, creamos un certificado, usuario y recurso compartido para confirmar el funcionamiento de este módulo por completo. Para ello, realizamos las siguientes acciones:</p>
<ol>
<li>
<p>Creamos un certificado:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/vpn-test-certificate.png"><img alt="OpenVPN test certificate" src="../assets/zentyal/vpn-test-certificate.png" title="OpenVPN test certificate"/></a></p>
</li>
<li>
<p>Creamos un usuario del dominio:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/vpn-test-user.png"><img alt="OpenVPN test user" src="../assets/zentyal/vpn-test-user.png" title="OpenVPN test user"/></a></p>
</li>
<li>
<p>Creamos una carpeta compartida con permisos de lectura y escritura para el usuario de pruebas creado:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/vpn-test-share-1.png"><img alt="OpenVPN test share" src="../assets/zentyal/vpn-test-share-1.png" title="OpenVPN test share"/></a>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/vpn-test-share-2.png"><img alt="OpenVPN test share permissions" src="../assets/zentyal/vpn-test-share-2.png" title="OpenVPN test share permissions"/></a></p>
</li>
<li>
<p>Guardamos los cambios.</p>
</li>
<li>
<p>Descargamos un bundle con la configuración de la conexión VPN para el cliente, para ello vamos a <code>VPN -&gt; Servers -&gt; Download client bundle</code>:</p>
<div class="admonition nota">
<p class="admonition-title">Nota</p>
<p>Para este ejemplo concreto, para la máquina del cliente usaré un Windows 10 con OpenVPN ya instalado.</p>
</div>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/vpn-test-bundle.png"><img alt="OpenVPN test bundle" src="../assets/zentyal/vpn-test-bundle.png" title="OpenVPN test bundle"/></a></p>
</li>
<li>
<p>Copiamos el bundle al cliente desde donde queramos establecer la conexión VPN y configuramos el cliente de OpenVPN:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/vpn-client-configuration.png"><img alt="OpenVPN client configuration" src="../assets/zentyal/vpn-client-configuration.png" title="OpenVPN client configuration"/></a></p>
</li>
<li>
<p>Establecemos la conexión desde el cliente de OpenVPN. Si todo fue bien, podremos ver en el archivo de log de la conexión VPN de Zentyal llamado <code>/var/log/openvpn/Icecrown-RecursosCompartidos.log</code> unos registros similares a:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-60-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-60-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-60-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-60-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-60-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-60-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-60-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-60-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-60-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-60-10">10</a></span>
<span class="normal"><a href="#__codelineno-60-11">11</a></span>
<span class="normal"><a href="#__codelineno-60-12">12</a></span>
<span class="normal"><a href="#__codelineno-60-13">13</a></span>
<span class="normal"><a href="#__codelineno-60-14">14</a></span>
<span class="normal"><a href="#__codelineno-60-15">15</a></span>
<span class="normal"><a href="#__codelineno-60-16">16</a></span>
<span class="normal"><a href="#__codelineno-60-17">17</a></span>
<span class="normal"><a href="#__codelineno-60-18">18</a></span>
<span class="normal"><a href="#__codelineno-60-19">19</a></span>
<span class="normal"><a href="#__codelineno-60-20">20</a></span>
<span class="normal"><a href="#__codelineno-60-21">21</a></span>
<span class="normal"><a href="#__codelineno-60-22">22</a></span>
<span class="normal"><a href="#__codelineno-60-23">23</a></span>
<span class="normal"><a href="#__codelineno-60-24">24</a></span>
<span class="normal"><a href="#__codelineno-60-25">25</a></span>
<span class="normal"><a href="#__codelineno-60-26">26</a></span>
<span class="normal"><a href="#__codelineno-60-27">27</a></span>
<span class="normal"><a href="#__codelineno-60-28">28</a></span>
<span class="normal"><a href="#__codelineno-60-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1"></a>Sat Feb  4 20:51:33 2023 88.6.127.36:35754 TLS: Initial packet from [AF_INET]88.6.127.36:35754 (via [AF_INET]10.0.1.200%ens5), sid=7c56b72b 70d7b663
<a id="__codelineno-60-2" name="__codelineno-60-2"></a>Sat Feb  4 20:51:33 2023 88.6.127.36:35754 VERIFY OK: depth=1, C=ES, ST=Spain, L=Zaragoza, O=Icecrown CA, CN=Icecrown CA Authority Certificate
<a id="__codelineno-60-3" name="__codelineno-60-3"></a>Sat Feb  4 20:51:33 2023 88.6.127.36:35754 VERIFY X509NAME OK: C=ES, ST=Spain, L=Zaragoza, O=Icecrown CA, CN=Icecrown-RC-Maria
<a id="__codelineno-60-4" name="__codelineno-60-4"></a>Sat Feb  4 20:51:33 2023 88.6.127.36:35754 VERIFY OK: depth=0, C=ES, ST=Spain, L=Zaragoza, O=Icecrown CA, CN=Icecrown-RC-Maria
<a id="__codelineno-60-5" name="__codelineno-60-5"></a>Sat Feb  4 20:51:33 2023 88.6.127.36:35754 peer info: IV_VER=2.6.0
<a id="__codelineno-60-6" name="__codelineno-60-6"></a>Sat Feb  4 20:51:33 2023 88.6.127.36:35754 peer info: IV_PLAT=win
<a id="__codelineno-60-7" name="__codelineno-60-7"></a>Sat Feb  4 20:51:33 2023 88.6.127.36:35754 peer info: IV_TCPNL=1
<a id="__codelineno-60-8" name="__codelineno-60-8"></a>Sat Feb  4 20:51:33 2023 88.6.127.36:35754 peer info: IV_MTU=1600
<a id="__codelineno-60-9" name="__codelineno-60-9"></a>Sat Feb  4 20:51:33 2023 88.6.127.36:35754 peer info: IV_NCP=2
<a id="__codelineno-60-10" name="__codelineno-60-10"></a>Sat Feb  4 20:51:33 2023 88.6.127.36:35754 peer info: IV_CIPHERS=AES-256-GCM:AES-128-GCM
<a id="__codelineno-60-11" name="__codelineno-60-11"></a>Sat Feb  4 20:51:33 2023 88.6.127.36:35754 peer info: IV_PROTO=478
<a id="__codelineno-60-12" name="__codelineno-60-12"></a>Sat Feb  4 20:51:33 2023 88.6.127.36:35754 peer info: IV_LZ4=1
<a id="__codelineno-60-13" name="__codelineno-60-13"></a>Sat Feb  4 20:51:33 2023 88.6.127.36:35754 peer info: IV_LZ4v2=1
<a id="__codelineno-60-14" name="__codelineno-60-14"></a>Sat Feb  4 20:51:33 2023 88.6.127.36:35754 peer info: IV_LZO=1
<a id="__codelineno-60-15" name="__codelineno-60-15"></a>Sat Feb  4 20:51:33 2023 88.6.127.36:35754 peer info: IV_COMP_STUB=1
<a id="__codelineno-60-16" name="__codelineno-60-16"></a>Sat Feb  4 20:51:33 2023 88.6.127.36:35754 peer info: IV_COMP_STUBv2=1
<a id="__codelineno-60-17" name="__codelineno-60-17"></a>Sat Feb  4 20:51:33 2023 88.6.127.36:35754 peer info: IV_GUI_VER=OpenVPN_GUI_11
<a id="__codelineno-60-18" name="__codelineno-60-18"></a>Sat Feb  4 20:51:33 2023 88.6.127.36:35754 peer info: IV_SSO=openurl,webauth,crtext
<a id="__codelineno-60-19" name="__codelineno-60-19"></a>Sat Feb  4 20:51:33 2023 88.6.127.36:35754 WARNING: 'tun-mtu' is used inconsistently, local='tun-mtu 1532', remote='tun-mtu 1500'
<a id="__codelineno-60-20" name="__codelineno-60-20"></a>Sat Feb  4 20:51:33 2023 88.6.127.36:35754 WARNING: 'cipher' is present in local config but missing in remote config, local='cipher AES-256-CBC'
<a id="__codelineno-60-21" name="__codelineno-60-21"></a>Sat Feb  4 20:51:33 2023 88.6.127.36:35754 Control Channel: TLSv1.3, cipher TLSv1.3 TLS_AES_256_GCM_SHA384, 4096 bit RSA
<a id="__codelineno-60-22" name="__codelineno-60-22"></a>Sat Feb  4 20:51:33 2023 88.6.127.36:35754 [Icecrown-RC-Maria] Peer Connection Initiated with [AF_INET]88.6.127.36:35754 (via [AF_INET]10.0.1.200%ens5)
<a id="__codelineno-60-23" name="__codelineno-60-23"></a>Sat Feb  4 20:51:33 2023 Icecrown-RC-Maria/88.6.127.36:35754 MULTI_sva: pool returned IPv4=192.168.210.2, IPv6=(Not enabled)
<a id="__codelineno-60-24" name="__codelineno-60-24"></a>Sat Feb  4 20:51:34 2023 Icecrown-RC-Maria/88.6.127.36:35754 PUSH: Received control message: 'PUSH_REQUEST'
<a id="__codelineno-60-25" name="__codelineno-60-25"></a>Sat Feb  4 20:51:34 2023 Icecrown-RC-Maria/88.6.127.36:35754 SENT CONTROL [Icecrown-RC-Maria]: 'PUSH_REPLY,route 10.0.1.0 255.255.255.0,route-gateway 192.168.210.1,ping 10,ping-restart 120,ifconfig 192.168.210.2 255.255.255.0,peer-id 0,cipher AES-256-GCM' (status=1)
<a id="__codelineno-60-26" name="__codelineno-60-26"></a>Sat Feb  4 20:51:34 2023 Icecrown-RC-Maria/88.6.127.36:35754 Data Channel: using negotiated cipher 'AES-256-GCM'
<a id="__codelineno-60-27" name="__codelineno-60-27"></a>Sat Feb  4 20:51:34 2023 Icecrown-RC-Maria/88.6.127.36:35754 Outgoing Data Channel: Cipher 'AES-256-GCM' initialized with 256 bit key
<a id="__codelineno-60-28" name="__codelineno-60-28"></a>Sat Feb  4 20:51:34 2023 Icecrown-RC-Maria/88.6.127.36:35754 Incoming Data Channel: Cipher 'AES-256-GCM' initialized with 256 bit key
<a id="__codelineno-60-29" name="__codelineno-60-29"></a>Sat Feb  4 20:51:34 2023 Icecrown-RC-Maria/88.6.127.36:35754 MULTI: Learn: 00:ff:83:a2:23:96 -&gt; Icecrown-RC-Maria/88.6.127.36:35754
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Una vez la conexión ha sido establecida, desde el navegador de archivos, estableceremos la URL del servidor, que en mi caso es: <code>\\arthas.icecrown.es</code>. Tras lo cual, nos pedirá las credenciales del usuario.</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/vpn-client-credentials.png"><img alt="OpenVPN client log in credentials" src="../assets/zentyal/vpn-client-credentials.png" title="OpenVPN client log in credentials"/></a></p>
</li>
<li>
<p>Tras logearnos, deberíamos de ver el directorio personal del usuario y los recursos compartidos.</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../assets/zentyal/vpn-client-shares.png"><img alt="OpenVPN client view" src="../assets/zentyal/vpn-client-shares.png" title="OpenVPN client view"/></a></p>
</li>
<li>
<p>Añadimos un archivo a los recursos <code>Maria</code> y <code>rrhh</code> y verificamos su creación desde la CLI del servidor Zentyal:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-61-1">1</a></span>
<span class="normal"><a href="#__codelineno-61-2">2</a></span>
<span class="normal"><a href="#__codelineno-61-3">3</a></span>
<span class="normal"><a href="#__codelineno-61-4">4</a></span>
<span class="normal"><a href="#__codelineno-61-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1"></a>ls<span class="w"> </span>-l<span class="w"> </span>/home/maria/test-file-1.txt
<a id="__codelineno-61-2" name="__codelineno-61-2"></a><span class="w">    </span>-rwxrwx--x+<span class="w"> </span><span class="m">1</span><span class="w"> </span>ICECROWN<span class="se">\m</span>aria<span class="w"> </span>ICECROWN<span class="se">\d</span>omain<span class="w"> </span>users<span class="w"> </span><span class="m">0</span><span class="w"> </span>Feb<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">20</span>:56<span class="w"> </span>/home/maria/test-file-1.txt
<a id="__codelineno-61-3" name="__codelineno-61-3"></a>
<a id="__codelineno-61-4" name="__codelineno-61-4"></a>ls<span class="w"> </span>-l<span class="w"> </span>/home/samba/shares/rrhh/test-file-2.txt
<a id="__codelineno-61-5" name="__codelineno-61-5"></a><span class="w">    </span>-rwxrwx---+<span class="w"> </span><span class="m">1</span><span class="w"> </span>ICECROWN<span class="se">\m</span>aria<span class="w"> </span>ICECROWN<span class="se">\d</span>omain<span class="w"> </span>users<span class="w"> </span><span class="m">0</span><span class="w"> </span>Feb<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">20</span>:56<span class="w"> </span>/home/samba/shares/rrhh/test-file-2.txt
</code></pre></div></td></tr></table></div>
</li>
</ol>
<p>Llegados a este punto, el servidor estaría listo para usarse en producción, no obstante, tal y como se ha mencionado en varias ocasiones, es altamente recomendable realizar ciertas tareas adicionales como:</p>
<ul>
<li>Usar certificados expedidos por entidades de certificación reconocidas.</li>
<li>Securizar el servicio de correo con SPF, DKIM y DMARC.</li>
<li>Establecer restricciones relativas a las contraseñas de los usuarios de dominio.</li>
<li>Crear una política de copias de seguridad.</li>
<li>Monitorizar el servidor.</li>
<li>Conocer y programar tareas de mantenimiento.</li>
</ul>
<p>Todos estas configuraciones serán explicadas en otras páginas del proyecto (ver menú superior).</p>
<hr/>
<div class="md-source-file">
<small>
    
      Última actualización:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">12 de abril de 2023</span>
<br/>
        Creado:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">12 de abril de 2023</span>
</small>
</div>
</article>
</div>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
            Volver al principio
          </button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": ["navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.indexes", "toc.integrate", "content.code.copy", "content.code.annotate", "navigation.top"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
<script src="../assets/javascripts/bundle.51198bba.min.js"></script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>